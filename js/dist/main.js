function parallax(t){var e=document.querySelectorAll(".parallax");window.onscroll=function(){for(var a=0;a<e.length;a++){var n=$(e[a]).offset(),r=(window.height,window.pageYOffset/n.top),o=[0,-10,-60,-40,0,-20],s=[];s[a]="50% "+(o[a]+r*t)+"%",e[a].style.backgroundPosition=s[a]}}}function collapseNavbar(){$(".navbar").offset().top>50?$(".navbar-fixed-top").addClass("top-nav-collapse"):$(".navbar-fixed-top").removeClass("top-nav-collapse")}function app(){queue().defer(d3.json,"js/data/TOWN.geo.json").defer(d3.json,"js/data/TOWN.geo.json").awaitAll(generateMap)}function generateMap(t,e){function a(){n(2e3),$("#timeline").on("input change",function(){n($(this).val())})}function n(t){var e="yr"+t;$("#titlePrefix").html("Unintentional Opiod Overdose Deaths in Massachusetts from"),$("#fromYear1").html(t),$("#titleMidfix1").html(" to "),$("#toYear").html(parseInt(t)+1),d.selectAll("path").transition().duration(500).style("fill",function(t,a){var n=+t.properties.OPIOIDSTATS[e];return n===-9999?"#f1f1f1":u(n)})}function r(t,e,a){var n=550,r=80,o=d3.select("#"+e).append("svg").attr("width",n).attr("height",r),s=o.append("g"),l=[];l.push({d:-9999,r:"#f1f1f1",s:"N/A"});var i;for(i=0;i<t.domain().length;i++)l.push({d:t.domain()[i],r:t.range()[i],s:t.domainStrings()[i]});s.selectAll("rect").data(l).enter().append("rect").attr("height",20).attr("width",50).attr("x",function(t,e){return 55*e}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(t,e){return t.r}),s.selectAll("text").data(l).enter().append("text").attr("x",function(t,e){return 55*e}).attr("y",60).text(function(t,e){return t.s}).style("font-size","12px"),s.append("text").attr("class","vis-caption").attr("y",12).text(a)}var o,s=e[0],l=e[1];for(o=0;o<s.features.length;o++){if(s.features[o].properties.town!=l.features[o].TOWN)return void alert("Input data corrupted: generation of map terminated.");s.features[o].properties.OPIOIDSTATS=l.features[o].properties}var i=960,c=500,d=d3.select("#map_death").append("svg").attr("width",i).attr("height",c).style("border","0px solid steelblue"),u=d3.scale.threshold().domain([.01,6.9,15.9,31.5,1/0]).range(colorbrewer.Blues[5]);u.domainStrings=function(){return["< 0.01","0.01-6.9","6.9-15.9","15.9-31.5",">31.5"]};var p=d3.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([11e3]).translate([480,500]),h=d3.geo.path().projection(p);d.selectAll("path").data(s.features).enter().append("path").attr("d",function(t,e){return h(t)}).on("mousemove",function(t){var e=d3.mouse(d.node()).map(function(t){return parseInt(t)}),a="yr";currentvalue=a.concat(currentyear);var n;n=t.properties[currentvalue]>0?d3.format(".1f")(t.properties[currentvalue]):0==t.properties[currentvalue]?d3.format(".0f")(t.properties[currentvalue]):"N/A*",tooltip.classed("hidden",!1).attr("style","left:"+(e[0]+15)+"px !important; top:"+(e[1]+75)+"px !important").html("<b>"+toTitleCase(t.properties.TOWN)+"</b> | "+n)}).on("mouseover",function(t,e){d3.select(this).style("fill-opacity",.25).style("stroke","white").style("stroke-width","2px")}).on("mouseout",function(t,e){tooltip.classed("hidden",!0),d3.selectAll("path").style("fill-opacity",1).style("stroke","#2f363d").style("stroke-width","0.1px")}).style("stroke","#2f363d").style("stroke-width","0.1px").style("fill","white");a(),r(u,"legend_death","Unintentional Opioid Deaths per 100,000 people"),$(".controls-map").click(function(){$("#timeline").val($(this).data("select")),n($(this).data("select"))})}function app2(){queue().defer(d3.json,"js/data/TOWN.geo.json").defer(d3.json,"js/data/TOWN.geo.json").awaitAll(generateMap2)}function generateMap2(t,e){function a(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}function n(){r(2e3),$("#timeline").on("input change",function(){$(this).val();r($(this).val())})}function r(t){var e="yr"+t;s=t,$("#titlePrefix2").html("A Composite Indicator of the Impact of the Opioid Epidemic on Massachusetts in "),$("#fromYear2").html(t),p.selectAll("path").transition().duration(500).style("fill",function(t,a){var n=+t.properties.OPIOIDSTATS[e];return n===-9999?"#f1f1f1":f(n)})}function o(t,e,a){var n=550,r=80,o=d3.select("#"+e).append("svg").attr("width",n).attr("height",r),s=o.append("g"),l=[];l.push({d:-9999,r:"#f1f1f1",s:"N/A"});var i;for(i=0;i<t.domain().length;i++)l.push({d:t.domain()[i],r:t.range()[i],s:t.domainStrings()[i]});s.selectAll("rect").data(l).enter().append("rect").attr("height",20).attr("width",50).attr("x",function(t,e){return 55*e}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(t,e){return t.r}),s.selectAll("text").data(l).enter().append("text").attr("x",function(t,e){return 55*e}).attr("y",60).text(function(t,e){return t.s}).style("font-size","12px"),s.append("text").attr("class","vis-caption").attr("y",12).text(a)}var s,l,i=e[0],c=e[1];for(l=0;l<i.features.length;l++){if(i.features[l].properties.town!=c.features[l].TOWN)return void alert("Input data corrupted: generation of map terminated.");i.features[l].properties.OPIOIDSTATS=c.features[l].properties}var d=960,u=450,p=d3.select("#map_comp").append("svg").attr("width",d).attr("height",u).style("border","0px solid steelblue"),h=d3.select("#map_comp").append("div").attr("class","hidden tooltip2"),f=d3.scale.threshold().domain([.01,6.9,15.9,31.5,1/0]).range(colorbrewer.RdPu[5]);f.domainStrings=function(){return["< 0.01","0.01-6.9","6.9-15.9","15.9-31.5",">31.5"]};var m=d3.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([11e3]).translate([400,480]),g=d3.geo.path().projection(m);p.selectAll("path").data(i.features).enter().append("path").attr("d",function(t,e){return g(t)}).on("mousemove",function(t){var e=d3.mouse(p.node()).map(function(t){return parseInt(t)}),n="yr";currentvalue=n.concat(s);var r;r=t.properties[currentvalue]>0?d3.format(".1f")(t.properties[currentvalue]):0==t.properties[currentvalue]?d3.format(".0f")(t.properties[currentvalue]):"N/A*",h.classed("hidden",!1).attr("style","left:"+(e[0]+15)+"px !important; top:"+(e[1]+725)+"px !important").html("<b>"+a(t.properties.TOWN)+"</b> | "+r)}).on("mouseover",function(t,e){d3.select(this).style("fill-opacity",.25).style("stroke","white").style("stroke-width","2px")}).on("mouseout",function(t,e){h.classed("hidden",!0),d3.selectAll("path").style("fill-opacity",1).style("stroke","#2f363d").style("stroke-width","0.1px")}).style("stroke","#2f363d").style("stroke-width","0.1px").style("fill","white").on("mouseenter",function(t,e){}).on("mouseleave",function(t){});n(),o(f,"legend2","Composite Index Values")}function opioidsY2000(t,e){d3.select(".circle.opioids.y2015").attr("r",3).style("fill-opacity",.75).style("stroke-width","0"),d3.select(".circle.opioids.y2000").attr("r",15).style("fill-opacity",.9).style("stroke-width","0").style("stroke","#8e1014"),d3.select(".btn-bsas").classed("active",!0)}function opioidsY2015(t,e){d3.select(".circle.opioids.y2000").attr("r",3).style("fill-opacity",.75).style("stroke-width","0"),d3.select(".circle.opioids.y2015").attr("r",15).style("fill-opacity",.9).style("stroke-width","0").style("stroke","#8e1014"),d3.select(".btn-bsas").classed("active",!0)}!function(){function t(t){function n(){for(;l=d<c.length&&u<t;){var e=d++,n=c[e],o=a.call(n,1);o.push(r(e)),++u,n[0].apply(null,o)}}function r(t){return function(e,a){--u,null==h&&(null!=e?(h=e,d=p=NaN,o()):(c[t]=a,--p?l||n():o()))}}function o(){null!=h?f(h):i?f(h,c):f.apply(null,[h].concat(c))}var s,l,i,c=[],d=0,u=0,p=0,h=null,f=e;return t||(t=1/0),s={defer:function(){return h||(c.push(arguments),++p,n()),s},await:function(t){return f=t,i=!1,p||o(),s},awaitAll:function(t){return f=t,i=!0,p||o(),s}}}function e(){}var a=[].slice;t.version="1.0.7","function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:this.queue=t}(),document.createElement("article"),document.createElement("section");var speed=-80;parallax(speed),$(window).scroll(collapseNavbar),$(document).ready(collapseNavbar),$(function(){$("a.page-scroll").bind("click",function(t){t.preventDefault();var e=$(this);$("html, body").stop().animate({scrollTop:$(e.attr("href")).offset().top},1500,"easeInOutExpo"),t.preventDefault()})}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(t){var e=$(t.target).attr("href"),a=document.querySelector(e).clientHeight;$(e).parent().animate({height:a})}),$(".navbar-collapse ul li a").click(function(){"dropdown-toggle active"!=$(this).attr("class")&&"dropdown-toggle"!=$(this).attr("class")&&$(".navbar-toggle:visible").click()}),$(window).scroll(function(){$(window).scrollTop()>=400?$("#navigation").addClass("navbar-fixed-top"):$("#navigation").removeClass("navbar-fixed-top"),$(".target").each(function(){if($(window).scrollTop()>=$(this).offset().top-10){var t=$(this).attr("id");$("#navigation li").removeClass("active"),$("#navigation li[id="+t+"1]").addClass("active");var e=$(this).attr("data-index");$("#current-section").html(e)}})}),$("#navigation li").on("click",function(){$(this).parent().find("li").removeClass("active"),$(this).addClass("active")}),$("a[href*=#]:not([href=#])").click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")||location.hostname==this.hostname){var t=$(this.hash);if(t=t.length?t:$("[name="+this.hash.slice(1)+"]"),t.length)return $("html,body").animate({scrollTop:t.offset().top},500),!1}}),$("#pills-first a").click(function(t){t.preventDefault(),$(this).tab("show")}),$(".js-play-video").click(function(){var t=$($(this).data("target"));t.get(0)&&t.get(0).play()}),$(function(){$("#odInfographic").load("img/human1.svg",function(t){function e(t){$(".btn-svg").removeClass("active"),$('.btn-svg[value="'+t+'"]').addClass("active"),"1/12"==t?($(".svg-studyperiod").attr("opacity",0),$(".svg-onemonth").attr("opacity",1),$("#odInfographic_details").html("Only about <strong>1 in 12</strong> people who died from opioids had an active opioid prescription a month before they died")):($(".svg-studyperiod").attr("opacity",1),$("#odInfographic_details").html("About <strong>8 in 12</strong> people who died from opioids had an opioid prescription at some point during the study period"))}var a=($(this).find("svg"),"2/3");e(a),$(".btn-svg").on("click",function(){e($(this).val())}),$(".controls-svg").on("click",function(){e($(this).data("select"))})})}),$("p").each(function(){var t=$(this).html(),e=t.trim().split(" ");if(e.length>2){var a=e[e.length-1],n=e.slice(0,-1).join(" ");$(this).html(n+"&nbsp;"+a)}});var Vis=function(t){"use strict";function e(t,e,n){n.data.forEach(function(t,n){var o=r.append("div").attr("class","map-wrapper").append("div");a(o,e,t)})}function a(e,a,n){function r(e,a){t.selectAll(e)[0].forEach(function(e,n){var r=t.select(e);r.on(a)(r)})}e.append("span").text(function(t){return 2005==n.key?"2001 to 2005":2010==n.key?"2006 to 2010":2015==n.key?"2011 to 2015":void 0}).attr("class","vis-title").style("padding-bottom","3%"),e.append("span").text("").attr("class","selection-label");var l=e.classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+o+" "+s).classed("svg-content-responsive",!0);l.selectAll("path").data(a.features).enter().append("path").attr("d",i).style("stroke","white").style("stroke-width","0.0px").style("fill",function(t,e){var a=n.values[t.properties.TOWN_1];return c(a)}).on("mouseover",function(t,e){}).on("mouseout",function(t,e){}).attr("class",function(t){return t.properties.TOWN_1.toLowerCase()}).attr("id","bsasmap").on("mouseenter",function(t,e){r("."+t.properties.TOWN_1.toLowerCase(),"select")}).on("mouseleave",function(t){r("."+t.properties.TOWN_1.toLowerCase(),"unselect")}).on("select",function(e){var a,r=e.data();a=n.values[r[0].properties.TOWN_1]>0?t.format(".2f")(n.values[r[0].properties.TOWN]):"0",e.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML=r[0].properties.TOWN_1+"<br>"+a+" per 100,000",t.select(e.node()).style("fill-opacity",.4).style("stroke","white").style("stroke-width","1.5px")}).on("unselect",function(e){e.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML="",t.selectAll("path#bsasmap").style({"fill-opacity":1}).style("stroke","white").style("stroke-width","0.0px")})}function n(e,a,n){for(var r=60,o="90%",s=t.select("#"+a).append("svg").attr("width",o).attr("height",r),l=s.append("g"),i=[],c=0;c<e.domain().length;c++)i.push({d:e.domain()[c],r:e.range()[c],s:e.domainStrings()[c]});var d=100/i.length;l.selectAll("rect").data(i).enter().append("rect").attr("height",r/3).attr("width",function(t,e){return d+"%"}).attr("x",function(t,e){return e*d+"%"}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(t,e){return t.r}),l.selectAll("text").data(i).enter().append("text").attr("text-anchor","middle").attr("x",function(t,e){return e*d+d/2+"%"}).attr("y",55).text(function(t,e){return t.s}),l.append("text").attr("class","vis-caption").attr("y",12).text(n)}var r=t.select("#binaryMaps_maps");queue().defer(t.json,"js/data/TOWN.geo.json").defer(t.json,"js/data/rate_5yr_odc.json").await(e);var o=525,s=325,l=t.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([8600]).translate([280,360]),i=(t.select("#carte").append("svg").attr("width",o).attr("height",s),t.geo.path().projection(l)),c=t.scale.threshold().domain([.1,2.1,6.1,17.1,1/0]).range(["#d3d3d3","#db8d8d","#c54949","#b71c1c","#801313"]),d=t.scale.threshold().domain([.1,2.1,6.1,17.1,1/0]).range(["#d3d3d3","#db8d8d","#c54949","#b71c1c","#801313"]);d.domainStrings=function(){return["0",">0-2.1",">2.1-6.1",">6.1-17.1",">17.1"]},n(d,"binaryMaps_legend","Average 5 year Opioid-Related Death Rate per 100,000 people"),$(".js-toggle-binary-map").click(function(){var t=$(this).data("date");$("#binaryMaps").attr("data-active-date",t),$(".js-toggle-binary-map").removeClass("active"),$(this).addClass("active")})}(d3);console.log("file loaded - binary"),$(document).ready(function(){app(),app2()}),function(){"use strict";function t(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}function e(){queue().defer(d3.json,"js/data/opioid_count_by_town.geo.json").defer(d3.json,"js/data/opioid_count_by_town.geo.json").awaitAll(a)}function a(e,a){var r=a[0],o=a[1];$(".controls-map").click(function(){$("#odMap_timeline").val($(this).data("select")),s($(this).data("select"))});for(var u=0;u<r.features.length;u++){if(r.features[u].properties.town!==o.features[u].TOWN)return console.log("ASSERT failure for index: "+u),void console.log(r.features[u].properties.town+" mismatch with "+o.features[u].TOWN);r.features[u].properties.OPIOIDSTATS=o.features[u].properties}c=d3.select("#odMap_map").classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+f+" "+m).classed("svg-content-responsive",!0).style("border","0px solid steelblue");var p=d3.select("#odMap_map").append("div").attr("class","hidden vis-tooltip");d=d3.scale.threshold().domain([.01,1.01,5.01,15.01,33.01,64.01,1/0]).range(["#f1f1f1","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"]),d.domainStrings=function(){return["0","1","2-5","6-15","16-33","34-64",">64"]};var h=d3.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([1e4]).translate([f/1.8,1.1*m]),g=d3.geo.path().projection(h);c.selectAll("path").data(r.features).enter().append("path").classed("deathmap",!0).attr("d",function(t,e){return g(t)}).style("stroke","#2f363d").style("stroke-width","0.1px").style("fill","white").on("mousemove",function(e){var a=d3.mouse(c.node()).map(function(t){return parseInt(t)}),n="left:"+(100*a[0]/f+3)+"% !important;top:"+100*a[1]/m+"% !important;",r=a[0]>f/2?"-160%":0,o=a[1]>m/2?"-100%":0;n+="transform: translate("+r+","+o+");";var s,l="yr",d=l.concat(i);s=e.properties[d]>0?d3.format(".0f")(e.properties[d]):0===e.properties[d]?d3.format(".0f")(e.properties[d]):"N/A*",p.classed("hidden",!1).attr("style",n).html("<strong>"+t(e.properties.TOWN)+"</strong> | "+s)}).on("mouseover",function(t,e){d3.select(this).style("fill-opacity",.25).style("stroke","white").style("stroke-width","2px")}).on("mouseout",function(t,e){p.classed("hidden",!0),d3.selectAll("path.deathmap").style("fill-opacity",1).style("stroke","#2f363d").style("stroke-width","0.1px")}),n(),l(d,"odMap_legend","Count of Opioid Related Deaths by Municipality")}function n(){r(),$("#odMap_timeline").on("input change",function(){s($(this).val()),o()})}function r(){g<v?(g++,$("#odMap_timeline").val(g),s(g)):g=1999,u=setTimeout(r,2e3)}function o(){clearTimeout(u),console.log("stopped")}function s(t){var e="yr"+t;i=t,$("#odMap_titlePrefix").html("Opioid Related Deaths in Massachusetts in"),$("#odMap_fromYear").html(t),$("#odMap_source").html('Sources: <a target="_blank" href="http://www.mass.gov/eohhs/gov/departments/dph/programs/admin/dmoa/vitals/">Massachusetts Registry of Vital Records and Statistics</a>, <br><a target="_blank" href="http://www.mass.gov/eohhs/gov/departments/dph/">Massachusetts Department of Public Health</a>.</>'),c.selectAll("path.deathmap").transition().duration(500).style("fill",function(t,a){var n=+t.properties.OPIOIDSTATS[e];return n===-9999?"#f1f1f1":d(n)})}function l(t,e,a){for(var n=d3.select("#"+e).append("svg").attr("width",h).attr("height",p),r=n.append("g"),o=[],s=0;s<t.domain().length;s++)o.push({d:t.domain()[s],r:t.range()[s],s:t.domainStrings()[s]});var l=100/o.length;r.selectAll("rect").data(o).enter().append("rect").attr("height",p/3).attr("width",function(t,e){return l+"%"}).attr("x",function(t,e){return e*l+"%"}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(t,e){return t.r}),r.selectAll("text").data(o).enter().append("text").attr("text-anchor","middle").attr("x",function(t,e){return e*l+l/2+"%"}).attr("y",55).text(function(t,e){return t.s}),r.append("text").attr("class","vis-caption").attr("y",12).text(a)}var i,c,d,u,p=60,h="100%",f=600,m=400,g=1999,v=2015;$(document).ready(e)}();var Vis=function(t){"use strict";function e(t,e,n){n.data.forEach(function(t,n){var o=r.append("div").attr("class","map-wrapper").append("div");a(o,e,t)})}function a(e,a,n){function r(e,a){t.selectAll(e)[0].forEach(function(e,n){var r=t.select(e);r.on(a)(r)})}e.append("span").text(n.key).attr("class","vis-title"),e.append("span").text("").attr("class","selection-label");var l=e.classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+o+" "+s).classed("svg-content-responsive",!0);l.selectAll("path").data(a.features).enter().append("path").attr("d",i).style("stroke","white").style("stroke-width","0.0px").style("fill",function(t,e){var a=n.values[t.properties.TOWN];return c(a)}).on("mouseover",function(t,e){}).on("mouseout",function(t,e){}).attr("class",function(t){return t.properties.TOWN.toLowerCase()}).attr("id","bsasmap").on("mouseenter",function(t,e){r("."+t.properties.TOWN.toLowerCase(),"select")}).on("mouseleave",function(t){r("."+t.properties.TOWN.toLowerCase(),"unselect")}).on("select",function(e){var a,r=e.data();a=n.values[r[0].properties.TOWN]>=0?t.format("%,.2f")(n.values[r[0].properties.TOWN]):"N/A",e.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML=r[0].properties.TOWN_1+":  "+a,t.select(e.node()).style("fill-opacity",.4).style("stroke","white").style("stroke-width","1.5px")}).on("unselect",function(e){e.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML="",t.selectAll("path#bsasmap").style({"fill-opacity":1}).style("stroke","white").style("stroke-width","0.0px")})}function n(e,a,n){var r=70,o=t.select("#"+a).append("svg").attr("width","100%").attr("height",r),s=o.append("g"),l=[];l.push({d:-9999,r:"#d1d1d1",s:"N/A*"});var i;for(i=0;i<e.domain().length;i++)l.push({d:e.domain()[i],r:e.range()[i],s:e.domainStrings()[i]});s.selectAll("rect").data(l).enter().append("rect").attr("height",20).attr("width",60).attr("x",function(t,e){return e*(100/l.length)+"%"}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(t,e){return t.r}),s.selectAll("text").data(l).enter().append("text").attr("text-anchor","middle").attr("x",function(t,e){return e*(100/l.length)+7+"%"}).attr("y",55).text(function(t,e){return t.s}),s.append("text").attr("class","vis-caption").attr("y",12).text(n)}var r=t.select("#treatmentMaps_maps");queue().defer(t.json,"js/data/TOWN.geo.json").defer(t.json,"js/data/maps_susbtance_data.json").await(e);var o=525,s=325,l=t.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([7500]).translate([280,330]),i=(t.select("#carte").append("svg").attr("width",o).attr("height",s),t.geo.path().projection(l)),c=t.scale.threshold().domain([-.1,.01,.14,.24,.33,.46,1.1]).range(["#d1d1d1","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"]),d=t.scale.threshold().domain([0,.1,.15,.35,.6,1]).range(["#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"]);d.domainStrings=function(){return["0%",">0-14%",">14-24%",">24-33%",">33-46%",">46-100%"]},n(d,"treatmentMaps_legend","Heroin Primary Substance of Abuse upon Seeking Treatment (%)"),$(".js-toggle-treatment-map").click(function(){var t=$(this).data("date");$("#treatmentMaps").attr("data-active-date",t),$(".js-toggle-treatment-map").removeClass("active"),$(this).addClass("active")})}(d3);!function(){"use strict";function t(t){var e=d3.keys(t[0]).slice(1,65),a=[];t.forEach(function(t,n){var r=[];e.forEach(function(e){t[e]&&r.push({year:e,rate:t[e],Geography:t.Geography,FullName:t.FullName})}),a.push({Geography:t.Geography,FullName:t.FullName,rates:r})}),t.dataset=a,d.domain(d3.extent(e,function(t){return c.parse(t)})),u.domain([d3.max(a,function(t){return d3.max(t.rates,function(t){return+t.rate})}),0]);var r=m.selectAll("g.lines-death").data(a).enter().append("g").attr("class","lines-death");n=r.selectAll("path").data(function(t){return[t.rates]}).enter().append("path").attr("class","line-death").classed("massachusetts",function(t,e){return $.inArray(t[e].Geography,l)!==-1}).classed("usa",function(t,e){return $.inArray(t[e].Geography,i)!==-1})}function e(){s.width=o.clientWidth,s.width<500?s.margin.left=30:s.margin.left=50}function a(){e(),m.attr("width",s.width),d.range([s.margin.left,s.width-s.margin.right-s.margin.left]),u.range([s.margin.top,s.height-s.margin.bottom-s.margin.top]),p.scale(d).orient("bottom").ticks(s.width<500?8:15).tickFormat(function(t){return c(t)}).innerTickSize([8]),h.scale(u).orient(s.width<500?"right":"left").innerTickSize([8]),v.attr("x",s.width-s.margin.left),b.attr("y",-s.margin.left),s.width<500?y.attr("transform","translate("+s.margin.left+","+-s.margin.top/2+")"):y.attr("transform","translate("+s.margin.left+","+-s.margin.top/2+")"),f.x(function(t){return d(c.parse(t.year))}).y(function(t){return u(+t.rate)}).defined(function(t){return u(+t.rate)}),g.call(p),y.call(h),x.attr("x",s.width-s.margin.left-15).attr("y",u(23.8)-6),w.attr("x",s.width-s.margin.left-45).attr("y",u(10)-6),n.attr("d",f)}var n,r="#deathLines",o=document.querySelector(r),s={margin:{top:20,right:20,bottom:20,left:50},width:o.clientWidth,height:350},l=["MA"],i=["USA"],c=d3.time.format("%Y"),d=d3.time.scale(),u=d3.scale.sqrt(),p=d3.svg.axis(),h=d3.svg.axis(),f=d3.svg.line(),m=d3.select(r).append("svg").attr("width",s.width).attr("height",s.height),g=m.append("g").attr("class","vis-x-axis").attr("transform","translate(0,"+(s.height-s.margin.bottom-s.margin.top)+")").call(p),v=g.append("text").attr("x",s.width-s.margin.left).attr("y",s.margin.bottom).attr("dy","1em").attr("class","vis-x-axis-label").text("Year"),y=m.append("g").attr("class","vis-y-axis").attr("transform","translate("+s.margin.left+","+-s.margin.top/2+")").call(h),b=y.append("text").attr("x",-s.margin.top).attr("y",-s.margin.left).attr("dy","1em").attr("class","vis-y-axis-label").text("Age-Adjusted Opioid Death Rate per 100,000 People"),x=m.append("text").attr("class","aside-ma").attr("x",s.width-s.margin.left-15).attr("y",u(23.8)-6).attr("dy","1em").style("text-anchor","start").text("MA"),w=m.append("text").attr("class","aside-usa").attr("x",s.width-s.margin.left-45).attr("y",u(10)-6).attr("dy","1em").style("text-anchor","start").text("USA");d3.select("#deathLines").append("div").attr("class","vis-tooltip hidden");d3.csv("js/data/death_states.csv",function(e){t(e),a(),window.addEventListener("resize",a)})}(),function(){"use strict";function t(t){var e=new Date;e.setMonth(t.getMonth()-10);var a=Math.ceil(e.getMonth()/3);return"Q"+a}function e(){d3.selectAll("path.line").classed("unfocused",!1).classed("focused",!1),d3.selectAll("path.point").classed("unfocused",!1).classed("focused",!1).attr("d",d3.svg.symbol().type("circle").size(15)).style("fill-opacity","1"),H.classed("hidden",!0),Q.classed("hidden",!0)}function a(t,e){d3.selectAll("path.line").classed("unfocused",!0),d3.selectAll("path.point").classed("unfocused",!0).attr("d",d3.svg.symbol().type("circle").size(10)).style("fill-opacity","0"),d3.select(this).select("path.line").classed("unfocused",!1).classed("focused",!0);var a=(d3.mouse(this)[0],d3.mouse(this)[1]),n=N.invert(a),r=d3.format(".0%")(n);H.classed("hidden",!1).html(r),Q.classed("hidden",!1)}function n(t){var e=d3.mouse(this)[0],a=d3.mouse(this)[1],n=N.invert(a),r=d3.format(".0%")(n);Q.attr("transform","translate("+e+","+a+")"),H.style("top",d3.event.pageY-45+"px").style("left",d3.event.pageX+5+"px").html(r)}function r(){o(i.clientWidth),$.rangePoints([0,w]),A.rangePoints([0,w]),N.range([k,0]),j.scale($),O.scale($),T.scale(N),D.x(function(t){return $(t.label)}).y(function(t){return N(t.value)}),E.attr("transform","translate(0,"+k+")").call(j),I.attr("transform","translate(0,"+(k+15)+")").call(O),q.attr("x",w-y.left).attr("y",y.bottom-32),z.call(T),P.attr("width",b).attr("height",x),U.attr("d",function(t){return D(t.values)}),V.attr("d",function(t){return D(t.values)}),X.attr("class","vis-legend").attr("transform","translate("+(w-6*y.right)+",0)")}function o(t){b=t,w=b-y.left-y.right,k=x-y.top-y.bottom}function s(){var t=["FentanylHeroin","Fentanyl","Heroin","Methadone"],e=["Fentanyl & Heroin","Fentanyl","Heroin","Methadone"];X.attr("class","vis-legend").attr("transform","translate("+(w-8*y.right)+",0)");var a=15;t.forEach(function(t,n){K=X.append("g").attr("class","legend-item-"+t).attr("transform","translate(0,"+n*a+")"),K.append("svg:line").attr("class","legend-item-"+t).attr("x1",0).attr("y1",5).attr("x2",30).attr("y2",5).style("stroke",u[n]).style("stroke-dasharray",h[n]).style("stroke-width",p[n]),K.append("text").attr("class","legend-item-"+t).attr("x",40).attr("y",10).text(e[n])})}var l="#fentanyl-lines",i=document.querySelector("#fentanyl-lines"),c=[{date:new Date("01/01/2014"),FentanylHeroin:"0.19",Fentanyl:"0.22",Heroin:"0.41",Methadone:"0.10"},{date:new Date("04/01/2014"),FentanylHeroin:"0.18",Fentanyl:"0.19",Heroin:"0.49",Methadone:"0.07"},{date:new Date("07/01/2014"),FentanylHeroin:"0.14",Fentanyl:"0.14",Heroin:"0.53",Methadone:"0.10"},{date:new Date("10/01/2014"),FentanylHeroin:"0.22",Fentanyl:"0.27",Heroin:"0.35",Methadone:"0.06"},{date:new Date("01/01/2015"),FentanylHeroin:"0.19",Fentanyl:"0.40",Heroin:"0.30",Methadone:"0.04"},{date:new Date("04/01/2015"),FentanylHeroin:"0.24",Fentanyl:"0.38",Heroin:"0.29",Methadone:"0.05"},{date:new Date("07/01/2015"),FentanylHeroin:"0.19",Fentanyl:"0.40",Heroin:"0.30",Methadone:"0.06"},{date:new Date("10/01/2015"),FentanylHeroin:"0.22",Fentanyl:"0.43",Heroin:"0.24",Methadone:"0.05"},{date:new Date("01/01/2016"),FentanylHeroin:"0.15",Fentanyl:"0.50",Heroin:"0.17",Methadone:"0.04"}],d=d3.time.format("%Y"),u=["#333333","#b71c1c","#0071bc","#333333"],p=["1.5px","3.5px","3.5px","2px"],h=["10,10,10,10","0,0,0,0","0,0,0,0","2,6,0,0"],f=["circle","circle","circle","circle"],m=["1px","1.5px","1.5px","1px"],g=["#a50f15","#08519c","#636363","#636363"],v="date",y={top:10,right:15,bottom:50,left:42},b=540,x=400,w=b-y.left-y.right,k=x-y.top-y.bottom,$=d3.scale.ordinal().rangePoints([0,w]),A=d3.scale.ordinal().rangePoints([0,w]),N=d3.scale.linear().range([k,0]),_=d3.scale.ordinal().range(u),S=d3.scale.ordinal().range(p),C=d3.scale.ordinal().range(h),M=d3.scale.ordinal().range(f),F=d3.scale.ordinal().range(m),W=d3.scale.ordinal().range(g),j=d3.svg.axis().scale($).orient("bottom").ticks(d3.time.months,3).tickFormat(t),O=d3.svg.axis().scale($).ticks(d3.time.years,1).tickFormat(d).tickSize(3,0).tickPadding(1).orient("bottom"),B=d3.format(".0%"),T=d3.svg.axis().scale(N).orient("left").tickFormat(B).ticks(5).tickSize(3,0).tickPadding(1),H=d3.select("body").append("div").attr("class","vis-tooltip"),D=d3.svg.line().x(function(t){return $(t.label)}).y(function(t){return N(t.value)}),P=d3.select(document.querySelector(l)).append("svg"),Y=P.append("g").attr("transform","translate("+y.left+","+y.top+")"),L=d3.keys(c[0]).filter(function(t){return t!==v});_.domain(L),S.domain(L),C.domain(L),M.domain(L),F.domain(L),W.domain(L);var R=L.map(function(t){return{name:t,values:c.map(function(e){return{name:t,label:e[v],value:+e[t]}})}});$.domain(c.map(function(t){return t.date})),A.domain(c.map(function(t){return t.date})),N.domain([d3.min(R,function(t){return d3.min(t.values,function(t){return 0})}),d3.max(R,function(t){return d3.max(t.values,function(t){return t.value})})]);var E=Y.append("g").attr("class","vis-x-axis").attr("transform","translate(0,"+k+")").call(j),I=(E.append("path").attr("class","line").style("stroke-width","1.5px").call(j),Y.append("g").attr("class","vis-axis").attr("transform","translate(0,"+(k+15)+")").call(O)),q=I.append("text").attr("x",w-y.left).attr("y",y.bottom-32).attr("dy","1em").attr("class","vis-x-axis-label").text("Quarter"),z=Y.append("g").attr("class","vis-y-axis").call(T).append("text").attr("x",0).attr("y",-44).attr("dy","1em").attr("class","vis-y-axis-label").text("Percent Opioid Deaths"),G=Y.selectAll(".series").data(R).enter().append("g").attr("class","seriesData"),U=G.append("path").attr("class","line").attr("d",function(t){return D(t.values)}).style("stroke",function(t){return _(t.name)}).style("stroke-width",function(t){return S(t.name)}).style("stroke-dasharray",function(t){return C(t.name)}).style("fill","none"),V=G.append("path").attr("class","hit-area-ext").attr("d",function(t){return D(t.values)}).attr("style","stroke:transparent;stroke-width:10px").style("fill","none"),Q=Y.append("g").attr("class","focus").classed("hidden",!0);Q.append("circle").style("stroke-width",1).attr("r",6).attr("pointer-events","none"),d3.selectAll("g.seriesData").on("mouseover",a).on("mouseout",e).on("mousemove",n);var X=P.append("g"),K=X.append("g");r(),s(),window.addEventListener("resize",r)}(),function(){function t(){e(c.clientWidth),S.attr("width",h).attr("height",f),w.range([0,m]),k.range([g,0]),A.scale(w).tickFormat(b).ticks(m<500?4:10).orient("bottom").outerTickSize(0),N.scale(k).tickSize(m).orient("right").tickFormat(y),_.x(function(t){return w(t.age)}).y(function(t){return k(t.value)}).defined(function(t){return k(t.value)}),M.attr("transform","translate(0,"+g+")").call(A),F.call(N),C.selectAll(".vis-y-axis text").attr("x",-5).attr("dy",0).style("text-anchor","end"),D.attr("width",m).attr("height",g),W.attr("x",m-p.left).attr("y",p.bottom/2).attr("dy","1em").attr("class","vis-x-axis-label").text("Fiscal Year"),j.attr("x",-p.top).attr("y",-p.left).attr("dy","1em").attr("class","vis-y-axis-label").text("Percent Primary Substance of Use"),n(),o(),s()}function e(t){h=t,m=h-p.left-p.right}function a(){T.opioids.circle=C.append("circle").attr("class","circle opioids").attr("r",3),T.opioids.text=C.append("g").append("text").attr("class","focus opioids").text("opioids"),T.alcohol.circle=C.append("circle").attr("class","circle alcohol").attr("r",3),T.alcohol.text=C.append("g").append("text").attr("class","focus alcohol").text("alcohol"),
T.marijuana.circle=C.append("circle").attr("class","circle marijuana").attr("r",3),T.marijuana.text=C.append("g").append("text").attr("class","focus marijuana").text("marijuana"),T.other.circle=C.append("circle").attr("class","circle other").attr("r",3),T.other.text=C.append("g").append("text").attr("class","focus other").text("other"),T.none.circle=C.append("circle").attr("class","circle none").attr("r",3),T.none.text=C.append("g").append("text").attr("class","focus none").text("none")}function n(){var t=0,e=15;T.opioids.circle.attr("cx",m+B).attr("cy",t+1*e),T.opioids.text.attr("x",m+O).attr("y",t+1*e+3),T.alcohol.circle.attr("cx",m+B).attr("cy",t+2*e),T.alcohol.text.attr("x",m+O).attr("y",t+2*e+3),T.marijuana.circle.attr("cx",m+B).attr("cy",t+3*e),T.marijuana.text.attr("x",m+O).attr("y",t+3*e+3),T.other.circle.attr("cx",m+B).attr("cy",t+4*e),T.other.text.attr("x",m+O).attr("y",t+4*e+3),T.none.circle.attr("cx",m+B).attr("cy",t+5*e),T.none.text.attr("x",m+O).attr("y",t+5*e+3)}function r(){for(H.alcohol=C.append("path").attr("class","line alcohol").attr("pointer-events","none"),i=0;i<x[u+"alcohol"].values.length;i++){var t=(x[u+"alcohol"].values[i].age,x[u+"alcohol"].values[i].value);t>=0&&C.append("circle").attr("class",function(t){return"circle alcohol y"+x[u+"alcohol"].values[i].age}).attr("cx",w(x[u+"alcohol"].values[i].age)).attr("cy",k(x[u+"alcohol"].values[i].value)).attr("r",3).attr("pointer-events","none")}for(H.marijuana=C.append("path").attr("class","line marijuana").attr("pointer-events","none"),i=0;i<x[u+"marijuana"].values.length;i++){var t=(x[u+"marijuana"].values[i].age,x[u+"marijuana"].values[i].value);t>=0&&C.append("circle").attr("class",function(t){return"circle marijuana y"+x[u+"marijuana"].values[i].age}).attr("cx",w(x[u+"marijuana"].values[i].age)).attr("cy",k(x[u+"marijuana"].values[i].value)).attr("r",3).attr("pointer-events","none")}for(H.none=C.append("path").attr("class","line none").attr("pointer-events","none"),i=0;i<x[u+"none"].values.length;i++){var t=(x[u+"none"].values[i].age,x[u+"none"].values[i].value);t>=0&&C.append("circle").attr("class",function(t){return"circle none y"+x[u+"none"].values[i].age}).attr("cx",w(x[u+"none"].values[i].age)).attr("cy",k(x[u+"none"].values[i].value)).attr("r",3).attr("pointer-events","none")}for(H.opioids=C.append("path").attr("class","line opioids").attr("pointer-events","none"),i=0;i<x[u+"opioids"].values.length;i++){var t=(x[u+"opioids"].values[i].age,x[u+"opioids"].values[i].value);t>=0&&C.append("circle").attr("class",function(t){return"circle opioids y"+x[u+"opioids"].values[i].age}).attr("cx",w(x[u+"opioids"].values[i].age)).attr("cy",k(x[u+"opioids"].values[i].value)).attr("r",3).attr("pointer-events","none")}for(H.other=C.append("path").attr("class","line other").attr("pointer-events","none"),i=0;i<x[u+"other"].values.length;i++){var t=(x[u+"other"].values[i].age,x[u+"other"].values[i].value);t>=0&&C.append("circle").attr("class",function(t){return"circle other y"+x[u+"other"].values[i].age}).attr("cx",w(x[u+"other"].values[i].age)).attr("cy",k(x[u+"other"].values[i].value)).attr("r",3).attr("pointer-events","none")}}function o(){H.alcohol.attr("d",function(t){return _(x[u+"alcohol"].values)}),H.opioids.attr("d",function(t){return _(x[u+"opioids"].values)}),H.marijuana.attr("d",function(t){return _(x[u+"marijuana"].values)}),H.other.attr("d",function(t){return _(x[u+"other"].values)}),H.none.attr("d",function(t){return _(x[u+"none"].values)})}function s(){for(C.select(".line.alcohol").transition().duration(1e3).delay(180).attr("d",function(t){return _(x[u+"alcohol"].values)}),i=0;i<x[u+"alcohol"].values.length;i++){var t=".circle.alcohol.y"+x[u+"alcohol"].values[i].age;x[u+"alcohol"].values[i].value>=0?C.selectAll(t).transition().duration(1e3).attr("cx",function(t){return w(x[u+"alcohol"].values[i].age)}).attr("cy",function(t){return k(x[u+"alcohol"].values[i].value)}).attr("r",3):C.selectAll(t).transition().duration(1e3).attr("r",0)}for(C.select(".line.marijuana").transition().duration(1e3).attr("d",function(t){return _(x[u+"marijuana"].values)}),i=0;i<x[u+"marijuana"].values.length;i++){var t=".circle.marijuana.y"+x[u+"marijuana"].values[i].age;x[u+"marijuana"].values[i].value>=0?C.selectAll(t).transition().duration(1e3).attr("cx",function(t){return w(x[u+"marijuana"].values[i].age)}).attr("cy",function(t){return k(x[u+"marijuana"].values[i].value)}).attr("r",3):C.selectAll(t).transition().duration(1e3).attr("r",0)}for(C.select(".line.none").transition().duration(1e3).attr("d",function(t){return _(x[u+"none"].values)}),i=0;i<x[u+"none"].values.length;i++){var t=".circle.none.y"+x[u+"none"].values[i].age,e=x[u+"none"].values[i].value;x[u+"none"].values[i].value>=0?C.selectAll(t).transition().duration(1e3).attr("cx",function(t){return w(x[u+"none"].values[i].age)}).attr("cy",function(t){return k(x[u+"none"].values[i].value)}).attr("r",3):C.selectAll(t).transition().duration(1e3).attr("r",0)}for(C.select(".line.opioids").transition().duration(1e3).attr("d",function(t){return _(x[u+"opioids"].values)}),i=0;i<x[u+"opioids"].values.length;i++){var t=".circle.opioids.y"+x[u+"opioids"].values[i].age,e=x[u+"opioids"].values[i].value;e>=0?C.selectAll(t).transition().duration(1e3).attr("cx",function(t){return w(x[u+"opioids"].values[i].age)}).attr("cy",function(t){return k(x[u+"opioids"].values[i].value)}).attr("r",3):C.selectAll(t).transition().duration(1e3).attr("r",0)}for(C.select(".line.other").transition().duration(1e3).attr("d",function(t){return _(x[u+"other"].values)}),i=0;i<x[u+"other"].values.length;i++){var t=".circle.other.y"+x[u+"other"].values[i].age,e=x[u+"other"].values[i].value;e>=0?C.selectAll(t).transition().duration(1e3).attr("cx",function(t){return w(x[u+"other"].values[i].age)}).attr("cy",function(t){return k(x[u+"other"].values[i].value)}).attr("r",3):C.selectAll(t).transition().duration(1e3).attr("r",0)}}function l(t,e){return d3.keys(t).forEach(function(e){t[e]=+t[e],"age"!=e&&(e in x?x[e].values.push({age:t.age,value:t[e]}):x[e]={values:[{age:t.age,value:t[e]}]})}),t}var c=document.querySelector("#lines-bsas"),d={abington:"Abington",acton:"Acton",acushnet:"Acushnet",adams:"Adams",agawam:"Agawam",alford:"Alford",amesbury:"Amesbury",amherst:"Amherst",andover:"Andover",aquinnah:"Aquinnah",arlington:"Arlington",ashburnham:"Ashburnham",ashby:"Ashby",ashfield:"Ashfield",ashland:"Ashland",athol:"Athol",attleboro:"Attleboro",auburn:"Auburn",avon:"Avon",ayer:"Ayer",barnstable:"Barnstable",barre:"Barre",becket:"Becket",bedford:"Bedford",belchertown:"Belchertown",bellingham:"Bellingham",belmont:"Belmont",berkley:"Berkley",berlin:"Berlin",bernardston:"Bernardston",beverly:"Beverly",billerica:"Billerica",blackstone:"Blackstone",blandford:"Blandford",bolton:"Bolton",boston:"Boston",bourne:"Bourne",boxborough:"Boxborough",boxford:"Boxford",boylston:"Boylston",braintree:"Braintree",brewster:"Brewster",bridgewater:"Bridgewater",brimfield:"Brimfield",brockton:"Brockton",brookfield:"Brookfield",brookline:"Brookline",buckland:"Buckland",burlington:"Burlington",cambridge:"Cambridge",canton:"Canton",carlisle:"Carlisle",carver:"Carver",charlemont:"Charlemont",charlton:"Charlton",chatham:"Chatham",chelmsford:"Chelmsford",chelsea:"Chelsea",cheshire:"Cheshire",chester:"Chester",chesterfield:"Chesterfield",chicopee:"Chicopee",chilmark:"Chilmark",clarksburg:"Clarksburg",clinton:"Clinton",cohasset:"Cohasset",colrain:"Colrain",concord:"Concord",conway:"Conway",cummington:"Cummington",dalton:"Dalton",danvers:"Danvers",dartmouth:"Dartmouth",dedham:"Dedham",deerfield:"Deerfield",dennis:"Dennis",dighton:"Dighton",douglas:"Douglas",dover:"Dover",dracut:"Dracut",dudley:"Dudley",dunstable:"Dunstable",duxbury:"Duxbury",eastbridgewater:"East Bridgewater",eastbrookfield:"East Brookfield",eastham:"Eastham",easthampton:"Easthampton",eastlongmeadow:"East Longmeadow",easton:"Easton",edgartown:"Edgartown",egremont:"Egremont",erving:"Erving",essex:"Essex",everett:"Everett",fairhaven:"Fairhaven",fallriver:"Fall River",falmouth:"Falmouth",fitchburg:"Fitchburg",florida:"Florida",foxborough:"Foxborough",framingham:"Framingham",franklin:"Franklin",freetown:"Freetown",gardner:"Gardner",georgetown:"Georgetown",gill:"Gill",gloucester:"Gloucester",goshen:"Goshen",gosnold:"Gosnold",grafton:"Grafton",granby:"Granby",granville:"Granville",greatbarrington:"Great Barrington",greenfield:"Greenfield",groton:"Groton",groveland:"Groveland",hadley:"Hadley",halifax:"Halifax",hamilton:"Hamilton",hampden:"Hampden",hancock:"Hancock",hanover:"Hanover",hanson:"Hanson",hardwick:"Hardwick",harvard:"Harvard",harwich:"Harwich",hatfield:"Hatfield",haverhill:"Haverhill",hawley:"Hawley",heath:"Heath",hingham:"Hingham",hinsdale:"Hinsdale",holbrook:"Holbrook",holden:"Holden",holland:"Holland",holliston:"Holliston",holyoke:"Holyoke",hopedale:"Hopedale",hopkinton:"Hopkinton",hubbardston:"Hubbardston",hudson:"Hudson",hull:"Hull",huntington:"Huntington",ipswich:"Ipswich",kingston:"Kingston",lakeville:"Lakeville",lancaster:"Lancaster",lanesborough:"Lanesborough",lawrence:"Lawrence",lee:"Lee",leicester:"Leicester",lenox:"Lenox",leominster:"Leominster",leverett:"Leverett",lexington:"Lexington",leyden:"Leyden",lincoln:"Lincoln",littleton:"Littleton",longmeadow:"Longmeadow",lowell:"Lowell",ludlow:"Ludlow",lunenburg:"Lunenburg",lynn:"Lynn",lynnfield:"Lynnfield",malden:"Malden",manchester:"Manchester",mansfield:"Mansfield",marblehead:"Marblehead",marion:"Marion",marlborough:"Marlborough",marshfield:"Marshfield",mashpee:"Mashpee",mattapoisett:"Mattapoisett",maynard:"Maynard",medfield:"Medfield",medford:"Medford",medway:"Medway",melrose:"Melrose",mendon:"Mendon",merrimac:"Merrimac",methuen:"Methuen",middleborough:"Middleborough",middlefield:"Middlefield",middleton:"Middleton",milford:"Milford",millbury:"Millbury",millis:"Millis",millville:"Millville",milton:"Milton",monroe:"Monroe",monson:"Monson",montague:"Montague",monterey:"Monterey",montgomery:"Montgomery",mountwashington:"Mount Washington",nahant:"Nahant",nantucket:"Nantucket",natick:"Natick",needham:"Needham",newashford:"New Ashford",newbedford:"New Bedford",newbraintree:"New Braintree",newbury:"Newbury",newburyport:"Newburyport",newmarlborough:"New Marlborough",newsalem:"New Salem",newton:"Newton",norfolk:"Norfolk",northadams:"North Adams",northampton:"Northampton",northandover:"North Andover",northattleborough:"North Attleborough",northborough:"Northborough",northbridge:"Northbridge",northbrookfield:"North Brookfield",northfield:"Northfield",northreading:"North Reading",norton:"Norton",norwell:"Norwell",norwood:"Norwood",oakbluffs:"Oak Bluffs",oakham:"Oakham",orange:"Orange",orleans:"Orleans",otis:"Otis",oxford:"Oxford",palmer:"Palmer",paxton:"Paxton",peabody:"Peabody",pelham:"Pelham",pembroke:"Pembroke",pepperell:"Pepperell",peru:"Peru",petersham:"Petersham",phillipston:"Phillipston",pittsfield:"Pittsfield",plainfield:"Plainfield",plainville:"Plainville",plymouth:"Plymouth",plympton:"Plympton",princeton:"Princeton",provincetown:"Provincetown",quincy:"Quincy",randolph:"Randolph",raynham:"Raynham",reading:"Reading",rehoboth:"Rehoboth",revere:"Revere",richmond:"Richmond",rochester:"Rochester",rockland:"Rockland",rockport:"Rockport",rowe:"Rowe",rowley:"Rowley",royalston:"Royalston",russell:"Russell",rutland:"Rutland",salem:"Salem",salisbury:"Salisbury",sandisfield:"Sandisfield",sandwich:"Sandwich",saugus:"Saugus",savoy:"Savoy",scituate:"Scituate",seekonk:"Seekonk",sharon:"Sharon",sheffield:"Sheffield",shelburne:"Shelburne",sherborn:"Sherborn",shirley:"Shirley",shrewsbury:"Shrewsbury",shutesbury:"Shutesbury",somerset:"Somerset",somerville:"Somerville",southampton:"Southampton",southborough:"Southborough",southbridge:"Southbridge",southhadley:"South Hadley",southwick:"Southwick",spencer:"Spencer",springfield:"Springfield",sterling:"Sterling",stockbridge:"Stockbridge",stoneham:"Stoneham",stoughton:"Stoughton",stow:"Stow",sturbridge:"Sturbridge",sudbury:"Sudbury",sunderland:"Sunderland",sutton:"Sutton",swampscott:"Swampscott",swansea:"Swansea",taunton:"Taunton",templeton:"Templeton",tewksbury:"Tewksbury",tisbury:"Tisbury",tolland:"Tolland",topsfield:"Topsfield",townsend:"Townsend",truro:"Truro",tyngsborough:"Tyngsborough",tyringham:"Tyringham",upton:"Upton",uxbridge:"Uxbridge",wakefield:"Wakefield",wales:"Wales",walpole:"Walpole",waltham:"Waltham",ware:"Ware",wareham:"Wareham",warren:"Warren",warwick:"Warwick",washington:"Washington",watertown:"Watertown",wayland:"Wayland",webster:"Webster",wellesley:"Wellesley",wellfleet:"Wellfleet",wendell:"Wendell",wenham:"Wenham",westborough:"Westborough",westboylston:"West Boylston",westbridgewater:"West Bridgewater",westbrookfield:"West Brookfield",westfield:"Westfield",westford:"Westford",westhampton:"Westhampton",westminster:"Westminster",westnewbury:"West Newbury",weston:"Weston",westport:"Westport",westspringfield:"West Springfield",weststockbridge:"West Stockbridge",westtisbury:"West Tisbury",westwood:"Westwood",weymouth:"Weymouth",whately:"Whately",whitman:"Whitman",wilbraham:"Wilbraham",williamsburg:"Williamsburg",williamstown:"Williamstown",wilmington:"Wilmington",winchendon:"Winchendon",winchester:"Winchester",windsor:"Windsor",winthrop:"Winthrop",woburn:"Woburn",worcester:"Worcester",worthington:"Worthington",wrentham:"Wrentham",yarmouth:"Yarmouth"},u="massachusetts",p={top:0,right:25,bottom:35,left:45},h=c.clientWidth,f=400,m=h-p.left-p.right,g=f-p.top-p.bottom,v=d3.bisector(function(t){return t.age}).left,y=d3.format(",.0%"),b=d3.format("d"),x={},w=d3.scale.linear(),k=d3.scale.linear(),A=(d3.scale.category10(),d3.svg.axis()),N=d3.svg.axis(),_=d3.svg.line(),S=d3.select("#lines-bsas").append("svg"),C=S.append("g").attr("transform","translate("+p.left+","+p.top+")"),M=C.append("g").attr("class","vis-x-axis");M.append("text").attr("x",635).attr("y",15).attr("text-anchor","middle").text("Year");var F=C.append("g").attr("class","vis-y-axis");F.append("text");var W=M.append("text"),j=F.append("text"),O=-60,B=-70,T={opioids:{},alcohol:{},marijuana:{},other:{},none:{}};a();var H={},D=C.append("rect").attr("class","overlay");d3.csv("js/data/bsas-data-2000to2015.csv",l,function(e,a){function n(){var t=w.invert(d3.mouse(this)[0]),e=v(x[u+"alcohol"].values,t,1),a=x[u+"alcohol"].values[e-1],n=x[u+"alcohol"].values[e],r=t-a.age>n.age-t?n:a;r.value>=0?(o.attr("transform","translate("+w(r.age)+","+k(r.value)+")"),o.select("text").text(y(r.value)).attr("transform","translate(-28,0)"),o.select("circle").attr("r",4)):(o.select("circle").attr("r",0),o.select("text").text(""));var s=v(x[u+"marijuana"].values,t,1),d=x[u+"marijuana"].values[s-1],h=x[u+"marijuana"].values[s],f=t-d.age>h.age-t?h:d;f.value>=0?(l.attr("transform","translate("+w(f.age)+","+k(f.value)+")"),l.select("text").text(y(f.value)).attr("transform","translate(-28,0)"),l.select("circle").attr("r",4)):(l.select("circle").attr("r",0),l.select("text").text(""));var m=v(x[u+"none"].values,t,1),g=x[u+"none"].values[m-1],b=x[u+"none"].values[m],$=t-g.age>b.age-t?b:g;$.value>=0?(i.attr("transform","translate("+w($.age)+","+k($.value)+")"),i.select("text").text(y($.value)),i.select("circle").attr("r",4)):(i.select("circle").attr("r",0),i.select("text").text(""));var A=v(x[u+"opioids"].values,t,1),N=x[u+"opioids"].values[A-1],_=x[u+"opioids"].values[A],S=t-N.age>_.age-t?_:N;S.value>=0?(c.attr("transform","translate("+w(S.age)+","+k(S.value)+")"),c.select("text").text(y(S.value)),c.select("circle").attr("r",4)):(c.select("circle").attr("r",0),c.select("text").text(""));var C=v(x[u+"other"].values,t,1),M=x[u+"other"].values[C-1],F=x[u+"other"].values[C],W=t-M.age>F.age-t?F:M;W.value>=0?(p.attr("transform","translate("+w(W.age)+","+k(W.value)+")"),p.select("text").text(y(W.value)),p.select("circle").attr("r",4)):(p.select("circle").attr("r",0),p.select("text").text("")),t>80?(o.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),l.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),i.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),c.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),p.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning")):(o.select("text").attr("x",10).attr("text-anchor","beginning"),l.select("text").attr("x",10).attr("text-anchor","beginning"),i.select("text").attr("x",10).attr("text-anchor","beginning"),c.select("text").attr("x",10).attr("text-anchor","beginning"),p.select("text").attr("x",10).attr("text-anchor","beginning"))}if(e)throw e;w.domain([2e3,d3.max(a,function(t){return t.age})]),k.domain([0,1]),r(),t(),window.addEventListener("resize",t),$(".btn-bsas").addClass("active"),d3.selectAll(".btn-bsas").on("click",function(){u=d3.select(this).attr("data-val"),s(),d3.select(this).classed("active",!0),$("#tags").val("")}),$("#tags").autocomplete({source:function(t,e){var a=$.map(d,function(e){if(0===e.toUpperCase().indexOf(t.term.toUpperCase()))return e});e(a)},select:function(t,e){$.each(d,function(t,a){a===e.item.value&&(u=t,console.log(a))}),$(".btn-bsas").removeClass("active"),s()}});var o=C.append("g").attr("class","focus alcohol").style("display","none");o.append("circle").attr("pointer-events","none").attr("r",3),o.append("text").attr("pointer-events","none").attr("x",9).attr("dy",".35em");var l=C.append("g").attr("class","focus marijuana").style("display","none");l.append("circle").attr("pointer-events","none").attr("r",3),l.append("text").attr("pointer-events","none").attr("x",9).attr("dy",".35em");var i=C.append("g").attr("class","focus none").style("display","none");i.append("circle").attr("pointer-events","none").attr("r",3),i.append("text").attr("pointer-events","none").attr("x",9).attr("dy",".35em");var c=C.append("g").attr("class","focus opioids").style("display","none");c.append("circle").attr("pointer-events","none").attr("r",3),c.append("text").attr("pointer-events","none").attr("x",9).attr("dy",".35em");var p=C.append("g").attr("class","focus other").style("display","none");p.append("circle").attr("pointer-events","none").attr("r",3),p.append("text").attr("pointer-events","none").attr("x",9).attr("dy",".35em"),D.on("mouseover",function(){l.style("display",null),o.style("display",null),i.style("display",null),c.style("display",null),p.style("display",null)}).on("mouseout",function(){l.style("display","none"),o.style("display","none"),i.style("display","none"),c.style("display","none"),p.style("display","none")}).on("mousemove",n)})}(),$(document).ready(function(){function t(t,a){$("#percentage").html(t[a].Yes+"%"),$("#people").empty(),$("#people").each(function(){e(t,a),$("#table_substance").html('<table class="table" id="table_substance"><tr><th>Had legal prescription</th><th>Did not have legal prescription</th></tr><tr><td class="type_substance0">'+t[a].Yes+'%</td><td class="type_substance1">'+t[a].No+"%</td></tr></table>")})}function e(t,e){var r=[],o=Math.round(t[e].No),s=Math.round(t[e].Yes);blockArray=a("#people",s,o,t,r,e),n("#people",r,0)}function a(t,e,a,n,r,o){var s='<path d="M4,12.6c0-0.7,0-1.5,0-2.2c0-1,0.5-1.8,1.4-2.2C6,7.9,6.6,7.8,7.3,7.8c0.7,0,1.4,0,2.1,0c0.7,0,1.4,0.2,2,0.6c0.7,0.4,1.1,1.1,1.1,2c0,1.5,0,3,0,4.5c0,0.9-0.2,1.8-0.8,2.6c-0.1,0.2-0.3,0.3-0.4,0.5c-0.1,0.1-0.1,0.2-0.2,0.3c-0.1,0.6-0.3,1.2-0.4,1.8c-0.2,1.3-0.4,2.6-0.6,3.8c-0.1,0.7-0.6,1.1-1.3,1.1c-0.4,0-0.8,0-1.2,0c-0.1,0-0.2,0-0.3,0c-0.5-0.1-0.9-0.5-1-1c-0.2-1.2-0.4-2.4-0.6-3.5c-0.1-0.6-0.2-1.2-0.3-1.8c-0.1-0.3-0.2-0.5-0.4-0.7c-0.4-0.3-0.6-0.8-0.7-1.3C4.1,15.9,4,15.3,4,14.7C4,14,4,13.3,4,12.6z"/><path d="M4.8,3.6c0-1.8,1.4-3.4,3.4-3.5c1.9,0,3.5,1.5,3.5,3.5c0,2-1.5,3.4-3.5,3.4C6.3,7,4.8,5.5,4.8,3.6z"/>',l='<svg class="block type_substance1" width="25px" height="25px">'+s+"</svg>";for(b=0;b<a;b++)r.push(l);for(b=0;b<e;b++){var i='<svg class="block type_substance0" width="25px" height="25px">'+s+"</svg>";$(t).append(i)}return r}function n(t,e,a){a<blockArray.length&&($(t).append(e[a]),a++,n(t,e,a))}function r(t){$("#bar_svg").append("g").attr("class","bar_g"),xMax=d3.max(u,function(t){return d3.max(t,function(t){return t.x+t.x0})}),xScale=d3.scale.linear().domain([0,xMax]).range([0,f]),yScale=d3.scale.ordinal().rangeRoundBands([0,m],.1),colours=d3.scale.ordinal().range(t),bar_groups=v.selectAll(".bar_g").data(u).enter().append("g").style("fill",function(t,e){return colours(e)}),rects=bar_groups.selectAll("rect").data(function(t){return t}).enter().append("rect").style({stroke:"#b71c1c","stroke-width":"1px"}).attr("x",function(t){return xScale(t.x0)}).attr("y",function(t,e){return yScale(t.y)}).attr("height",function(t){return yScale.rangeBand()}).attr("width",function(t){return xScale(t.x)})}var o=[{Yes:83,No:17},{Yes:57,No:43},{Yes:50,No:50},{Yes:37,No:63}],s=[{Yes:65,No:35},{Yes:28,No:72},{Yes:20,No:80},{Yes:13,No:87}],l=[{Yes:68,No:32},{Yes:30,No:70},{Yes:22,No:78},{Yes:17,No:83}],i=[{Yes:64,No:36},{Yes:24,No:76},{Yes:15,No:85},{Yes:9,No:91}],c=[{Yes:76,No:24},{Yes:46,No:54},{Yes:41,No:59},{Yes:27,No:73}],d=[{Yes:60,No:40},{Yes:60,No:40},{Yes:60,No:40},{Yes:60,No:40}],u=[{data:[{count:867,name:"Heroin"}],name:"Heroin"},{data:[{count:288,name:"Fentanyl"}],name:"Fentanyl"},{data:[{count:249,name:"Fentanyl & Heroin"}],name:"Fentanyl & Heroin"},{data:[{count:154,name:"Prescription Opioids"}],name:"Prescription Opioids"},{data:[{count:84,name:"Methadone"}],name:"Methadone"}],p=o,h=0;t(p,h),$(".btn-substance").on("click",function(){var e,a=parseInt($(this).val());switch($(".btn-time").removeClass("disableClick disabled"),a){case 0:e=o;break;case 1:e=s;break;case 2:e=l;break;case 3:e=i;break;case 4:e=c;break;case 5:e=d,$(".btn-time").removeClass("active").addClass("disableClick disabled"),$("#studyperiod").addClass("active")}p=e,t(p,h)}),$(".btn-time").on("click",function(){$(".btn-time").removeClass("active"),$(this).addClass("active"),h=parseInt($(this).val()),t(p,h);var e;switch(h){case 0:e="during 20112014";break;case 1:e="6 Months Before Death";break;case 2:e="3 Months Before Death";break;case 3:e="1 Month Before Death"}$("#time-period").html(e.toLowerCase()),$("#label_blocks").html(e)});var f="100%",m=30;u=u.map(function(t){return t.data.map(function(t,e){return{y:t.count,s:t.name}})}),stack=d3.layout.stack(),stack(u);var g,u=u.map(function(t){return t.map(function(t){return{x:t.y,n:t.s,y:t.x,x0:t.y0}})}),v=d3.select("#bar").append("svg").attr("id","bar_svg").attr("width",f).attr("height",m),y=["#b71c1c","#CFD8DC"];g=[y[1],y[1],y[1],y[0],y[1],y[1]],r(g),$(".btn-substance").on("click",function(){$("#bar_svg").empty(),g=[y[1],y[1],y[1],y[1],y[1],y[1]],$(".btn-substance").removeClass("active"),$(this).addClass("active"),g[$(this).val()]=y[0],r(g);var t=$(this).val(),e=u[$(this).val()][0];parseFloat(xScale(e.x0)+100/(t+1)),parseFloat(d3.select(this).attr("y"))+yScale.rangeBand();console.log(e),console.log("Fentanyl & Heroin"==e.n),"Fentanyl & Heroin"==e.n?substance_html=e.n.toLowerCase()+'<a href="#footnote-7" class="page-scroll"><sup>7</sup></a>':"Prescription Opioids"==e.n?substance_html=e.n.toLowerCase()+'<a href="#footnote-8" class="page-scroll"><sup>8</sup></a>':substance_html=e.n.toLowerCase(),console.log(substance_html),$(".substance-type").html(substance_html),$("#total").html(e.x)})}),$(document).ready(function(){function asignVal_gender(option,value){$("#buttons-blocks button").removeClass("active"),$("#"+option).addClass("active"),$("#gender").empty(),makeChart_gender(eval(option)),$("#table_gender").html(table_html[value])}function makeChart_gender(t){var e=[];if(t==multi)var a=[0,1,2,3,4,5];else var a=[0,0,2,3,5,5];for(i=0;i<6;i++){var n=Math.round(t[i][1]);blockArray_gender=addBlocks_gender("#gender",n,t,e,a)}addBlock_gender("#gender",blockArray_gender,0)}function addBlock_gender(t,e,a){a<e.length&&($(t).append(e[a]),a++,addBlock_gender(t,e,a))}function addBlocks_gender(t,e,a,n,r){for(b=0;b<e;b++){var o='<svg class="block type_gender'+r[i]+" data-index="+a[i][0]+' width="25px" height="25px"><path d="M4,12.6c0-0.7,0-1.5,0-2.2c0-1,0.5-1.8,1.4-2.2C6,7.9,6.6,7.8,7.3,7.8c0.7,0,1.4,0,2.1,0c0.7,0,1.4,0.2,2,0.6c0.7,0.4,1.1,1.1,1.1,2c0,1.5,0,3,0,4.5c0,0.9-0.2,1.8-0.8,2.6c-0.1,0.2-0.3,0.3-0.4,0.5c-0.1,0.1-0.1,0.2-0.2,0.3c-0.1,0.6-0.3,1.2-0.4,1.8c-0.2,1.3-0.4,2.6-0.6,3.8c-0.1,0.7-0.6,1.1-1.3,1.1c-0.4,0-0.8,0-1.2,0c-0.1,0-0.2,0-0.3,0c-0.5-0.1-0.9-0.5-1-1c-0.2-1.2-0.4-2.4-0.6-3.5c-0.1-0.6-0.2-1.2-0.3-1.8c-0.1-0.3-0.2-0.5-0.4-0.7c-0.4-0.3-0.6-0.8-0.7-1.3C4.1,15.9,4,15.3,4,14.7C4,14,4,13.3,4,12.6z"/><path d="M4.8,3.6c0-1.8,1.4-3.4,3.4-3.5c1.9,0,3.5,1.5,3.5,3.5c0,2-1.5,3.4-3.5,3.4C6.3,7,4.8,5.5,4.8,3.6z"/></svg>';n.push(o)}return n}var prescription=[[0,0],["No",58],["Yes",13],["Yes",8],["No",21],[0,0]],heroin=[[0,0],["No",22],["Yes",49],["Yes",17],["No",12],[0,0]],multi=[["1",15],["2",31],["3",25],["3",18],["2",9],["1",2]],table_html=['<div class="people-blocks">Prescription Opioids in Toxicology Screen</div><table class="table" id="table_gender"><tr><th></th><th>Present</th><th>Not Present</th></tr><tr><th>Male</th><td class="type_gender2">'+prescription[2][1]+'%</td><td class="type_gender0">'+prescription[1][1]+'%</td></tr><tr><th>Female</th><td class="type_gender3">'+prescription[3][1]+'%</td><td class="type_gender5">'+prescription[4][1]+"%</td></tr></table>",'<div class="people-blocks">Heroin in Toxicology Screen</div><table class="table" id="table_gender"><tr><th></th><th>Present</th><th>Not Present</th></tr><tr><th>Male</th><td class="type_gender2">'+heroin[2][1]+'%</td><td class="type_gender0">'+heroin[1][1]+'%</td></tr><tr><th>Female</th><td class="type_gender3">'+heroin[3][1]+'%</td><td class="type_gender5">'+heroin[4][1]+"%</td></tr></table>",'<div class="people-blocks">Number of different prescribers</div><table class="table" id="table_gender"><tr><th></th><th>0 Prescribers</th><th>12 Prescribers</th><th>3+ Prescribers</th></tr><tr><th>Male</th><td td class="type_gender0">'+multi[0][1]+'%</td><td td class="type_gender1">'+multi[1][1]+'%</td><td td class="type_gender2">'+multi[2][1]+'%</td></tr><tr><th>Female</th><td td class="type_gender5">'+multi[5][1]+'%</td><td td class="type_gender4">'+multi[4][1]+'%</td><td td class="type_gender3">'+multi[3][1]+"%</td></tr></table>"],data_gender=prescription,value,option;makeChart_gender(prescription),$("#table_gender").html(table_html[0]),$("#prescription").addClass("active"),$(".controls-block").click(function(){$option=$(this).data("select"),"multi"==$option?$value=2:"heroin"==$option?$value=1:($option="prescription")&&($value=0),console.log($value),asignVal_gender($option,$value)}),$(".btn-blocks").click(function(){$option=$(this).attr("id"),$value=eval($(this).val()),asignVal_gender($option,$value)})}),function(){function t(){r=document.querySelector("#changing_bars").clientWidth-100,o=300,s=50,l.attr("width",r+100).attr("height",o+10)}function e(t,e){return t.sort(function(t,a){return a[e]-t[e]})}function a(t,e){d.text(n(e)).attr("class","vis-label").style("text-anchor","end").attr("y",12).attr("x",r+s+s);var a=d3.max(t,function(t){return+t[e]});xScale=d3.scale.linear().domain([0,a]).range([0,r]),yScale=d3.scale.ordinal().domain(d3.range(t.length)).rangeBands([20,o],.2);var i=l.selectAll("rect.bar").data(t,function(t){return t.gender_age});u.attr("class","vis-legend").attr("transform",function(t,e){return"translate("+(r-10)+","+(o-2*s+24*e)+")"}),i.enter().append("rect").attr("class","bar"),i.exit().transition().duration(200).ease("exp").attr("width",0).remove(),i.transition().duration(500).ease("quad").attr("width",function(t){return xScale(+t[e])}).attr("height",yScale.rangeBand()).attr("transform",function(t,e){return"translate("+[0+s,yScale(e)]+")"}).attr("class",function(t,e){return"Male"===t.gender&&"18 to 24"===t.age?"bar malFocus age18to24":"Female"===t.gender&&"18 to 24"===t.age?"bar femFocus age18to24":"Female"===t.gender&&"25 to 34"===t.age?"bar femFocus age25to34":"Male"===t.gender&&"25 to 34"===t.age?"bar malFocus age25to34":"Female"===t.gender?"bar femFocus":"Male"===t.gender?"bar malFocus":void 0});var c=l.selectAll("text.vis-data-label").data(t,function(t){return t.gender_age}),p=l.selectAll("text.vis-axis").data(t,function(t){return t.gender_age});p.enter().append("text").attr("class","vis-axis"),p.exit().remove(),c.enter().append("text").attr("class","vis-data-label"),c.exit().remove(),numberFormat=d3.format(".0f"),percentageFormat=d3.format(".1f"),rateFormat=d3.format(".1f"),c.transition().duration(500).attr("transform",function(t,a){return"translate("+(xScale(+t[e])+s)+","+(yScale(a)+4)+")"}).text(function(t){return"percentOpiodDeaths"==e&&"65+"==t.age?"<1%":"percentOpiodDeaths"==e&&"65+"!=t.age?percentageFormat(t[e])+"%":"numberOpioidDeaths"==e?numberFormat(t[e]):rateFormat(t[e])}).attr("dy","1em").attr("dx","5px"),p.transition().duration(500).attr("transform",function(t,e){return"translate(0,"+(yScale(e)+5)+")"}).text(function(t){return t.age}).attr("dy","1em").attr("dx","40px")}function n(t){var e={percentOpiodDeaths:"Percent Opioid Deaths among All Deaths",deathRate:"Opioid Death Rate per 100,000 People per Year",numberOpioidDeaths:"Number of Opioid Deaths"};return e[t]}var r=600,o=300,s=50,l=d3.select("#changing_bars").append("svg").attr("width",r+100).attr("height",o+10);l.append("rect").attr("width","100%").attr("height","100%").attr("fill","none");var i=d3.scale.ordinal().range(["malFocus","femFocus"]),c=d3.scale.ordinal().range(["Male","Female"]),d=(l.append("text").text("Age").attr("class","vis-x-axis-label").style("text-anchor","start").attr("y",10).attr("x",10),l.append("text")),u=l.selectAll(".vis-legend").data(["male","female"]).enter().append("g");u.append("rect").attr("x",0).attr("width",20).attr("height",20).attr("class",i),u.append("text").attr("x",25).attr("y",9).attr("dy",".5em").style("text-anchor","start").text(c),d3.csv("js/data/bars-age.csv",function(n,r){var o="percentOpiodDeaths",s=e(r,o);t(),a(s,o),window.addEventListener("resize",function(){t(),a(s,o)}),d3.select("#POD").classed("selected",!0),$("#POD").addClass("active"),d3.select("#POD").on("click",function(t,n){o="percentOpiodDeaths",s=e(r,o),a(s,o);var l=d3.select(this);d3.selectAll("#buttons-bar button").classed("selected",!1),$("#buttons-bar button").removeClass("active"),d3.selectAll("#age18to24").classed("selected",!1),$("#age18to24").removeClass("active"),l.classed("selected",!0),$(this).addClass("active")}),d3.select("#DR").on("click",function(t,n){o="deathRate",s=e(r,o),a(s,o);var l=d3.select(this);d3.selectAll("#buttons-bar button").classed("selected",!1),$("#buttons-bar button").removeClass("active"),d3.selectAll("#age18to24").classed("selected",!1),$("#age18to24").removeClass("active"),l.classed("selected",!0),$(this).addClass("active")}),d3.select("#NOD").on("click",function(t,n){o="numberOpioidDeaths",s=e(r,o),a(s,o);var l=d3.select(this);d3.selectAll("#buttons-bar button").classed("selected",!1),$("#buttons-bar button").removeClass("active"),d3.selectAll("#age18to24").classed("selected",!1),$("#age18to24").removeClass("active"),l.classed("selected",!0),$(this).addClass("active")}),d3.select("#age18to24").on("click",function(t,e){var a=d3.select(this);a.classed("selected",!0),$(this).addClass("active"),d3.selectAll(".malFocus.age18to24").classed("malSelector",!0),d3.selectAll(".femFocus.age18to24").classed("femSelector",!0),d3.selectAll(".malFocus.age25to34").classed("malSelector",!1),d3.selectAll(".femFocus.age25to34").classed("femSelector",!1)}),d3.select("#age25to34").on("click",function(t,e){var a=d3.select(this);a.classed("selected",!0),$(this).addClass("active"),d3.selectAll(".malFocus.age25to34").classed("malSelector",!0),d3.selectAll(".femFocus.age25to34").classed("femSelector",!0),d3.selectAll(".malFocus.age18to24").classed("malSelector",!1),d3.selectAll(".femFocus.age18to24").classed("femSelector",!1)})})}(),$(document).ready(function(){function t(t,e){t.each(function(){for(var t,a=d3.select(this),n=a.text().split(/\s+/).reverse(),r=[],o=0,s=1.1,l=a.attr("y"),i=parseFloat(a.attr("dy")),c=a.text(null).append("tspan").attr("x",0).attr("y",l).attr("dy",i+"em");t=n.pop();)r.push(t),
c.text(r.join(" ")),c.node().getComputedTextLength()>e&&(r.pop(),c.text(r.join(" ")),r=[t],c=a.append("tspan").attr("x",0).attr("y",l).attr("dy",++o*s+i+"em").text(t))})}function e(){a(),c.rangeRoundBands([0,i.rangeBand()]),i.rangeRoundBands([0,n],.1),d.range([r,0]),u.scale(i),p.scale(d),f.attr("width",n+s.left+s.right).attr("height",r+s.top+s.bottom),v.attr("transform","translate(10,"+r+")").call(u).selectAll(".tick text").call(t,i.rangeBand()),y.call(p),k.attr("x",n-18),A.attr("x",n-24),b.attr("transform",function(t){return"translate("+(i(t.raceth)-10)+",0)"}),x.attr("width",c.rangeBand()).attr("x",function(t){return c(t.name)+20}).attr("y",function(t){return d(t.value)}).attr("value",function(t){return t.name}).attr("height",function(t){return r-d(t.value)})}function a(){var t=document.querySelector("#race_ethnicity_chart").clientWidth;s={top:50,right:10,bottom:60,left:50},n=t-s.left-s.right,r=t<500?350-s.top-s.bottom:500-s.top-s.bottom}dataset=[{raceth:"All",2014:19.8,2015:23.2},{raceth:"White non-Hispanic",2014:23.3,2015:27.1},{raceth:"Black non-Hispanic",2014:11.1,2015:13.6},{raceth:"Hispanic",2014:15.3,2015:19.5}];var n,r,o=d3.scale.ordinal().range(["#B0BEC5","#455A64"]),s={};a();var i=d3.scale.ordinal().rangeRoundBands([0,n],.1),c=d3.scale.ordinal(),d=d3.scale.linear().range([r,0]),u=d3.svg.axis().scale(i).orient("bottom"),p=d3.svg.axis().scale(d).orient("left").tickFormat(d3.format(".0f")),h=d3.select("#race_ethnicity_chart").append("div").classed("vis-tooltip hidden",!0),f=d3.select("#race_ethnicity_chart").append("svg"),m=f.append("g").attr("transform","translate("+s.left+","+s.top+")"),g=d3.keys(dataset[0]).filter(function(t){return"raceth"!==t});dataset.forEach(function(t){t.values=g.map(function(e){return{name:e,value:+t[e]}})}),i.domain(dataset.map(function(t){return t.raceth})),c.domain(g).rangeRoundBands([0,i.rangeBand()]),d.domain([0,d3.max(dataset,function(t){return d3.max(t.values,function(t){return t.value})})]);var v=m.append("g").attr("class","vis-x-axis").attr("transform","translate(10,"+r+")"),y=m.append("g").attr("class","vis-y-axis");y.append("text").attr("y",-35).attr("dy",".71em").attr("class","vis-y-axis-label").text("Age Adjusted Rates per 100,000");var b=m.selectAll(".bar").data(dataset).enter().append("g").attr("class","rect").attr("transform",function(t){return"translate("+(i(t.raceth)-10)+",0)"}),x=b.selectAll("rect").data(function(t){return t.values}).enter().append("rect");x.attr("width",c.rangeBand()).attr("x",function(t){return c(t.name)+5}).attr("y",function(t){return d(t.value)}).attr("value",function(t){return t.name}).attr("height",function(t){return r-d(t.value)}).style("fill",function(t){return o(t.name)}),b.on("mousemove",function(t){h.style("left",d3.event.pageX-$("#race_ethnicity_chart").offset().left+"px"),h.style("top",d3.event.pageY-$("#race_ethnicity_chart").offset().top+"px"),h.classed("hidden",!1);var e=(d3.event.pageX,d3.event.pageY,document.querySelectorAll(":hover"));l=e.length,l-=1,elementData=e[l].__data__,h.html("<rate>"+elementData.value+"</rate>")}),b.on("mouseout",function(t){h.classed("hidden",!0)});var w=m.selectAll(".vis-legend").data(g.slice()).enter().append("g").attr("class","vis-legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"}),k=w.append("rect").attr("x",n-18).attr("width",18).attr("height",18).style("fill",o),A=w.append("text").attr("x",n-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t});e(),window.addEventListener("resize",e)});
//# sourceMappingURL=main.js.map
