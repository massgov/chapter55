function parallax(t){var e=document.querySelectorAll(".parallax");window.onscroll=function(){for(var a=0;a<e.length;a++){var n=$(e[a]).offset(),r=(window.height,window.pageYOffset/n.top),s=[0,-10,-60,-40,0,-20],o=[];o[a]="50% "+(s[a]+r*t)+"%",e[a].style.backgroundPosition=o[a]}}}function collapseNavbar(){$(".navbar").offset().top>50?$(".navbar-fixed-top").addClass("top-nav-collapse"):$(".navbar-fixed-top").removeClass("top-nav-collapse")}function app(){queue().defer(d3.json,"js/data/TOWN.geo.json").defer(d3.json,"js/data/TOWN.geo.json").awaitAll(generateMap)}function generateMap(t,e){function a(){n(2e3),$("#timeline").on("input change",function(){n($(this).val())})}function n(t){var e="yr"+t;$("#titlePrefix").html("Unintentional Opiod Overdose Deaths in Massachusetts from"),$("#fromYear1").html(t),$("#titleMidfix1").html(" to "),$("#toYear").html(parseInt(t)+1),d.selectAll("path").transition().duration(500).style("fill",function(t,a){var n=+t.properties.OPIOIDSTATS[e];return n===-9999?"#f1f1f1":u(n)})}function r(t,e,a){var n=550,r=80,s=d3.select("#"+e).append("svg").attr("width",n).attr("height",r),o=s.append("g"),l=[];l.push({d:-9999,r:"#f1f1f1",s:"N/A"});var i;for(i=0;i<t.domain().length;i++)l.push({d:t.domain()[i],r:t.range()[i],s:t.domainStrings()[i]});o.selectAll("rect").data(l).enter().append("rect").attr("height",20).attr("width",50).attr("x",function(t,e){return 55*e}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(t,e){return t.r}),o.selectAll("text").data(l).enter().append("text").attr("x",function(t,e){return 55*e}).attr("y",60).text(function(t,e){return t.s}).style("font-size","12px"),o.append("text").attr("class","vis-caption").attr("y",12).text(a)}var s,o=e[0],l=e[1];for(s=0;s<o.features.length;s++){if(o.features[s].properties.town!=l.features[s].TOWN)return console.log("ASSERT failure for index: "+s),console.log(o.features[s].properties.town+" mismatch with "+l.features[s].TOWN),void alert("Input data corrupted: generation of map terminated.");o.features[s].properties.OPIOIDSTATS=l.features[s].properties}var i=960,c=500,d=d3.select("#map_death").append("svg").attr("width",i).attr("height",c).style("border","0px solid steelblue"),u=d3.scale.threshold().domain([.01,6.9,15.9,31.5,1/0]).range(colorbrewer.Blues[5]);u.domainStrings=function(){return["< 0.01","0.01-6.9","6.9-15.9","15.9-31.5",">31.5"]};var p=d3.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([11e3]).translate([480,500]),h=d3.geo.path().projection(p);d.selectAll("path").data(o.features).enter().append("path").attr("d",function(t,e){return h(t)}).on("mousemove",function(t){var e=d3.mouse(d.node()).map(function(t){return parseInt(t)}),a="yr";currentvalue=a.concat(currentyear);var n;n=t.properties[currentvalue]>0?d3.format(".1f")(t.properties[currentvalue]):0==t.properties[currentvalue]?d3.format(".0f")(t.properties[currentvalue]):"N/A*",tooltip.classed("hidden",!1).attr("style","left:"+(e[0]+15)+"px !important; top:"+(e[1]+75)+"px !important").html("<b>"+toTitleCase(t.properties.TOWN)+"</b> | "+n)}).on("mouseover",function(t,e){d3.select(this).style("fill-opacity",.25).style("stroke","white").style("stroke-width","2px")}).on("mouseout",function(t,e){tooltip.classed("hidden",!0),d3.selectAll("path").style("fill-opacity",1).style("stroke","#2f363d").style("stroke-width","0.1px")}).style("stroke","#2f363d").style("stroke-width","0.1px").style("fill","white");a(),r(u,"legend_death","Unintentional Opioid Deaths per 100,000 people"),$(".controls-map").click(function(){$("#timeline").val($(this).data("select")),n($(this).data("select"))})}function app2(){queue().defer(d3.json,"js/data/TOWN.geo.json").defer(d3.json,"js/data/TOWN.geo.json").awaitAll(generateMap2)}function generateMap2(t,e){function a(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}function n(){r(2e3),$("#timeline").on("input change",function(){$(this).val();r($(this).val())})}function r(t){var e="yr"+t;o=t,console.log(o),$("#titlePrefix2").html("A Composite Indicator of the Impact of the Opioid Epidemic on Massachusetts in "),$("#fromYear2").html(t),p.selectAll("path").transition().duration(500).style("fill",function(t,a){var n=+t.properties.OPIOIDSTATS[e];return n===-9999?"#f1f1f1":g(n)})}function s(t,e,a){var n=550,r=80,s=d3.select("#"+e).append("svg").attr("width",n).attr("height",r),o=s.append("g"),l=[];l.push({d:-9999,r:"#f1f1f1",s:"N/A"});var i;for(i=0;i<t.domain().length;i++)l.push({d:t.domain()[i],r:t.range()[i],s:t.domainStrings()[i]});o.selectAll("rect").data(l).enter().append("rect").attr("height",20).attr("width",50).attr("x",function(t,e){return 55*e}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(t,e){return t.r}),o.selectAll("text").data(l).enter().append("text").attr("x",function(t,e){return 55*e}).attr("y",60).text(function(t,e){return t.s}).style("font-size","12px"),o.append("text").attr("class","vis-caption").attr("y",12).text(a)}var o,l,i=e[0],c=e[1];for(l=0;l<i.features.length;l++){if(i.features[l].properties.town!=c.features[l].TOWN)return console.log("ASSERT failure for index: "+l),console.log(i.features[l].properties.town+" mismatch with "+c.features[l].TOWN),void alert("Input data corrupted: generation of map terminated.");i.features[l].properties.OPIOIDSTATS=c.features[l].properties}var d=960,u=450;console.log(u);var p=d3.select("#map_comp").append("svg").attr("width",d).attr("height",u).style("border","0px solid steelblue"),h=d3.select("#map_comp").append("div").attr("class","hidden tooltip2"),g=d3.scale.threshold().domain([.01,6.9,15.9,31.5,1/0]).range(colorbrewer.RdPu[5]);g.domainStrings=function(){return["< 0.01","0.01-6.9","6.9-15.9","15.9-31.5",">31.5"]};var f=d3.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([11e3]).translate([400,480]),m=d3.geo.path().projection(f);p.selectAll("path").data(i.features).enter().append("path").attr("d",function(t,e){return m(t)}).on("mousemove",function(t){var e=d3.mouse(p.node()).map(function(t){return parseInt(t)}),n="yr";currentvalue=n.concat(o);var r;console.log(u),r=t.properties[currentvalue]>0?d3.format(".1f")(t.properties[currentvalue]):0==t.properties[currentvalue]?d3.format(".0f")(t.properties[currentvalue]):"N/A*",console.log(r),h.classed("hidden",!1).attr("style","left:"+(e[0]+15)+"px !important; top:"+(e[1]+725)+"px !important").html("<b>"+a(t.properties.TOWN)+"</b> | "+r)}).on("mouseover",function(t,e){d3.select(this).style("fill-opacity",.25).style("stroke","white").style("stroke-width","2px")}).on("mouseout",function(t,e){h.classed("hidden",!0),d3.selectAll("path").style("fill-opacity",1).style("stroke","#2f363d").style("stroke-width","0.1px")}).style("stroke","#2f363d").style("stroke-width","0.1px").style("fill","white").on("mouseenter",function(t,e){}).on("mouseleave",function(t){});n(),s(g,"legend2","Composite Index Values")}function type(t,e){return d3.keys(t).forEach(function(e){t[e]=+t[e],"age"!=e&&(e in groups?groups[e].values.push({age:t.age,value:t[e]}):groups[e]={values:[{age:t.age,value:t[e]}]})}),t}!function(){function t(t){function n(){for(;l=d<c.length&&u<t;){var e=d++,n=c[e],s=a.call(n,1);s.push(r(e)),++u,n[0].apply(null,s)}}function r(t){return function(e,a){--u,null==h&&(null!=e?(h=e,d=p=NaN,s()):(c[t]=a,--p?l||n():s()))}}function s(){null!=h?g(h):i?g(h,c):g.apply(null,[h].concat(c))}var o,l,i,c=[],d=0,u=0,p=0,h=null,g=e;return t||(t=1/0),o={defer:function(){return h||(c.push(arguments),++p,n()),o},await:function(t){return g=t,i=!1,p||s(),o},awaitAll:function(t){return g=t,i=!0,p||s(),o}}}function e(){}var a=[].slice;t.version="1.0.7","function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:this.queue=t}(),document.createElement("article"),document.createElement("section");var speed=-80;parallax(speed),$(window).scroll(collapseNavbar),$(document).ready(collapseNavbar),$(function(){$("a.page-scroll").bind("click",function(t){var e=$(this);$("html, body").stop().animate({scrollTop:$(e.attr("href")).offset().top},1500,"easeInOutExpo"),t.preventDefault()})}),$(".navbar-collapse ul li a").click(function(){"dropdown-toggle active"!=$(this).attr("class")&&"dropdown-toggle"!=$(this).attr("class")&&$(".navbar-toggle:visible").click()}),$(window).scroll(function(){$(window).scrollTop()>=400?$("#navigation").addClass("navbar-fixed-top"):$("#navigation").removeClass("navbar-fixed-top"),$(".target").each(function(){if($(window).scrollTop()>=$(this).offset().top-10){var t=$(this).attr("id");$("#navigation li").removeClass("active"),$("#navigation li[id="+t+"1]").addClass("active");var e=$(this).attr("data-index");$("#current-section").html(e)}})}),$("#navigation li").on("click",function(){$(this).parent().find("li").removeClass("active"),$(this).addClass("active")}),$("a[href*=#]:not([href=#])").click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")||location.hostname==this.hostname){var t=$(this.hash);if(t=t.length?t:$("[name="+this.hash.slice(1)+"]"),t.length)return $("html,body").animate({scrollTop:t.offset().top},500),!1}}),$("#pills-first a").click(function(t){t.preventDefault(),$(this).tab("show")}),$(".js-play-video").click(function(){var t=$($(this).data("target"));t.get(0)&&t.get(0).play()}),$(function(){$("#odInfographic").load("img/human1.svg",function(t){function e(t){$(".btn-svg").removeClass("active"),$('.btn-svg[value="'+t+'"]').addClass("active"),"1/12"==t?($(".svg-studyperiod").attr("opacity",0),$(".svg-onemonth").attr("opacity",1),$("#odInfographic_details").html("Only about <strong>1 in 12</strong> people who died from opioids had an active opioid prescription a month before they died")):($(".svg-studyperiod").attr("opacity",1),$("#odInfographic_details").html("About <strong>8 in 12</strong> people who died from opioids had an opioid prescription at some point during the study period"))}var a=($(this).find("svg"),"2/3");e(a),$(".btn-svg").on("click",function(){e($(this).val())}),$(".controls-svg").on("click",function(){e($(this).data("select"))})})}),$(document).ready(function(){app(),app2()}),function(){"use strict";function t(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}function e(){queue().defer(d3.json,"js/data/opioid_count_by_town.geo.json").defer(d3.json,"js/data/opioid_count_by_town.geo.json").awaitAll(a)}function a(e,a){var c=a[0],d=a[1];$(".controls-map").click(function(){$("#odMap_timeline").val($(this).data("select")),r($(this).data("select"))});for(var h=0;h<c.features.length;h++){if(c.features[h].properties.town!==d.features[h].TOWN)return console.log("ASSERT failure for index: "+h),void console.log(c.features[h].properties.town+" mismatch with "+d.features[h].TOWN);c.features[h].properties.OPIOIDSTATS=d.features[h].properties}l=d3.select("#odMap_map").classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+u+" "+p).classed("svg-content-responsive",!0).style("border","0px solid steelblue");var g=d3.select("#odMap_map").append("div").attr("class","hidden vis-tooltip");i=d3.scale.threshold().domain([.01,1.01,5.01,15.01,33.01,64.01,1/0]).range(["#f1f1f1","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"]),i.domainStrings=function(){return["0","1","2-5","6-15","16-33","34-64",">64"]};var f=d3.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([1e4]).translate([u/1.8,1.1*p]),m=d3.geo.path().projection(f);l.selectAll("path").data(c.features).enter().append("path").classed("deathmap",!0).attr("d",function(t,e){return m(t)}).style("stroke","#2f363d").style("stroke-width","0.1px").style("fill","white").on("mousemove",function(e){var a=d3.mouse(l.node()).map(function(t){return parseInt(t)}),n="left:"+(100*a[0]/u+3)+"% !important;top:"+100*a[1]/p+"% !important;",r=a[0]>u/2?"-160%":0,s=a[1]>p/2?"-100%":0;n+="transform: translate("+r+","+s+");";var i,c="yr",d=c.concat(o);i=e.properties[d]>0?d3.format(".0f")(e.properties[d]):0===e.properties[d]?d3.format(".0f")(e.properties[d]):"N/A*",g.classed("hidden",!1).attr("style",n).html("<strong>"+t(e.properties.TOWN)+"</strong> | "+i)}).on("mouseover",function(t,e){d3.select(this).style("fill-opacity",.25).style("stroke","white").style("stroke-width","2px")}).on("mouseout",function(t,e){g.classed("hidden",!0),d3.selectAll("path.deathmap").style("fill-opacity",1).style("stroke","#2f363d").style("stroke-width","0.1px")}),n(),s(i,"odMap_legend","Count of Opioid Related Deaths by Municipality")}function n(){r(2e3),$("#odMap_timeline").on("input change",function(){r($(this).val())})}function r(t){var e="yr"+t;o=t,$("#odMap_titlePrefix").html("Count of Opiod Related Deaths in Massachusetts in"),$("#odMap_fromYear").html(t),$("#odMap_source").html("Sources: Massachusetts Department of Public Health,<br>Massachusetts Registry of Vital Records and Statistics</>"),l.selectAll("path.deathmap").transition().duration(500).style("fill",function(t,a){var n=+t.properties.OPIOIDSTATS[e];return n===-9999?"#f1f1f1":i(n)})}function s(t,e,a){for(var n=d3.select("#"+e).append("svg").attr("width",d).attr("height",c),r=n.append("g"),s=[],o=0;o<t.domain().length;o++)s.push({d:t.domain()[o],r:t.range()[o],s:t.domainStrings()[o]});var l=100/s.length;r.selectAll("rect").data(s).enter().append("rect").attr("height",c/3).attr("width",function(t,e){return l+"%"}).attr("x",function(t,e){return e*l+"%"}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(t,e){return t.r}),r.selectAll("text").data(s).enter().append("text").attr("text-anchor","middle").attr("x",function(t,e){return e*l+l/2+"%"}).attr("y",55).text(function(t,e){return t.s}),r.append("text").attr("class","vis-caption").attr("y",12).text(a)}var o,l,i,c=60,d="100%",u=600,p=400;$(document).ready(e)}();var Vis=function(t){function e(e,n,o){var l=t.select("#treatmentMaps_maps");o.data.forEach(function(t,e){var o=l.append("div").style({width:r+"px",height:s+"px"});a(o,n,t)})}function a(e,a,n){function o(e,a){t.selectAll(e)[0].forEach(function(e,n){var r=t.select(e);r.on(a)(r)})}e.append("span").text(n.key).attr("class","vis-title"),e.append("span").text("").attr("class","selection-label"),e.append("y");var c=e.append("svg").attr({width:r,height:s});c.selectAll("path").data(a.features).enter().append("path").attr("d",l).style("stroke","white").style("stroke-width","0.0px").style("fill",function(t,e){var a=n.values[t.properties.TOWN];return i(a)}).on("mouseover",function(t,e){}).on("mouseout",function(t,e){}).attr("class",function(t){return t.properties.TOWN.toLowerCase()}).attr("id","bsasmap").on("mouseenter",function(t,e){o("."+t.properties.TOWN.toLowerCase(),"select")}).on("mouseleave",function(t){o("."+t.properties.TOWN.toLowerCase(),"unselect")}).on("select",function(e){var a,r=e.data();a="Null"!==n.values[r[0].properties.TOWN]?t.format("%,.2f")(n.values[r[0].properties.TOWN]):"N/A",e.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML=r[0].properties.TOWN+":  "+a,t.select(e.node()).style("fill-opacity",.4).style("stroke","white").style("stroke-width","1.5px")}).on("unselect",function(e){e.node().parentNode.parentNode.getElementsByClassName("selection-label")[0].innerHTML="",t.selectAll("path#bsasmap").style({"fill-opacity":1}).style("stroke","white").style("stroke-width","0.0px")})}function n(e,a,n){var r=550,s=70,o=t.select("#"+a).append("svg").attr("width",r).attr("height",s),l=o.append("g"),i=[];i.push({d:-9999,r:"#f1f1f1",s:"N/A*"});var c;for(c=0;c<e.domain().length;c++)i.push({d:e.domain()[c],r:e.range()[c],s:e.domainStrings()[c]});l.selectAll("rect").data(i).enter().append("rect").attr("height",20).attr("width",60).attr("x",function(t,e){return 60*e}).attr("y",20).style("stroke","black").style("stroke-width","0.25px").style("fill",function(t,e){return t.r}),l.selectAll("text").data(i).enter().append("text").attr("text-anchor","middle").attr("x",function(t,e){return 60*e+30}).attr("y",55).text(function(t,e){return t.s}),l.append("text").attr("class","vis-caption").attr("y",12).text(n)}queue().defer(t.json,"js/data/TOWN.geo.json").defer(t.json,"js/data/data.json").await(e);var r=525,s=325,o=t.geo.conicConformal().parallels([41+43/60,42+41/60]).rotate([71.5,-41]).scale([7500]).translate([250,350]),l=(t.select("#carte").append("svg").attr("width",r).attr("height",s),t.geo.path().projection(o)),i=t.scale.threshold().domain([0,.1,.15,.35,.6,1]).range(colorbrewer.YlOrBr[6]),c=t.scale.threshold().domain([0,.1,.15,.35,.6,1]).range(colorbrewer.YlOrBr[6]);c.domainStrings=function(){return["0%",">0-10%",">10-15%",">15-35%",">35-60%",">60-100%"]},n(c,"treatmentMaps_legend","Heroin Primary Substance of Abuse upon Seeking Treatment (%)")}(d3);!function(){"use strict";function t(t){var e=d3.keys(t[0]).slice(1,65),a=[];t.forEach(function(t,n){var r=[];e.forEach(function(e){t[e]&&r.push({year:e,rate:t[e],Geography:t.Geography,FullName:t.FullName})}),a.push({Geography:t.Geography,FullName:t.FullName,rates:r})}),t.dataset=a,d.domain(d3.extent(e,function(t){return c.parse(t)})),u.domain([d3.max(a,function(t){return d3.max(t.rates,function(t){return+t.rate})}),0]);var r=f.selectAll("g.lines-death").data(a).enter().append("g").attr("class","lines-death");n=r.selectAll("path").data(function(t){return[t.rates]}).enter().append("path").attr("class","line-death").classed("massachusetts",function(t,e){return $.inArray(t[e].Geography,l)!==-1}).classed("usa",function(t,e){return $.inArray(t[e].Geography,i)!==-1})}function e(){o.width=s.clientWidth,o.width<500?o.margin.left=30:o.margin.left=50}function a(){e(),f.attr("width",o.width),d.range([o.margin.left,o.width-o.margin.right-o.margin.left]),u.range([o.margin.top,o.height-o.margin.bottom-o.margin.top]),p.scale(d).orient("bottom").ticks(o.width<500?8:15).tickFormat(function(t){return c(t)}).innerTickSize([8]),h.scale(u).orient(o.width<500?"right":"left").innerTickSize([8]),v.attr("x",o.width-o.margin.left),b.attr("y",-o.margin.left),o.width<500?y.attr("transform","translate("+o.margin.left+","+-o.margin.top/2+")"):y.attr("transform","translate("+o.margin.left+","+-o.margin.top/2+")"),g.x(function(t){return d(c.parse(t.year))}).y(function(t){return u(+t.rate)}).defined(function(t){return u(+t.rate)}),m.call(p),y.call(h),x.attr("x",o.width-o.margin.left-15).attr("y",u(23.8)-6),w.attr("x",o.width-o.margin.left-45).attr("y",u(10)-6),n.attr("d",g)}var n,r="#deathLines",s=document.querySelector(r),o={margin:{top:20,right:20,bottom:20,left:50},width:s.clientWidth,height:350},l=["MA"],i=["USA"],c=d3.time.format("%Y"),d=d3.time.scale(),u=d3.scale.sqrt(),p=d3.svg.axis(),h=d3.svg.axis(),g=d3.svg.line(),f=d3.select(r).append("svg").attr("width",o.width).attr("height",o.height),m=f.append("g").attr("class","vis-x-axis").attr("transform","translate(0,"+(o.height-o.margin.bottom-o.margin.top)+")").call(p),v=m.append("text").attr("x",o.width-o.margin.left).attr("y",o.margin.bottom).attr("dy","1em").attr("class","vis-x-axis-label").text("Year"),y=f.append("g").attr("class","vis-y-axis").attr("transform","translate("+o.margin.left+","+-o.margin.top/2+")").call(h),b=y.append("text").attr("x",-o.margin.top).attr("y",-o.margin.left).attr("dy","1em").attr("class","vis-y-axis-label").text("Age-Adjusted Opioid Death Rate per 100,000 People"),x=f.append("text").attr("class","aside-ma").attr("x",o.width-o.margin.left-15).attr("y",u(23.8)-6).attr("dy","1em").style("text-anchor","start").text("MA"),w=f.append("text").attr("class","aside-usa").attr("x",o.width-o.margin.left-45).attr("y",u(10)-6).attr("dy","1em").style("text-anchor","start").text("USA");d3.select("#deathLines").append("div").attr("class","vis-tooltip hidden");d3.csv("js/data/death_states.csv",function(e){t(e),a(),window.addEventListener("resize",a)})}(),function(){"use strict";function t(t){var e=new Date;e.setMonth(t.getMonth()-10);var a=Math.ceil(e.getMonth()/3);return"Q"+a}function e(){d3.selectAll("path.line").classed("unfocused",!1).classed("focused",!1),d3.selectAll("path.point").classed("unfocused",!1).classed("focused",!1).attr("d",d3.svg.symbol().type("circle").size(15)).style("fill-opacity","1"),D.classed("hidden",!0),Y.classed("hidden",!0)}function a(t,e){d3.selectAll("path.line").classed("unfocused",!0),d3.selectAll("path.point").classed("unfocused",!0).attr("d",d3.svg.symbol().type("circle").size(10)).style("fill-opacity","0"),d3.select(this).select("path.line").classed("unfocused",!1).classed("focused",!0);var a=(d3.mouse(this)[0],d3.mouse(this)[1]),n=b.invert(a),r=d3.format(".0%")(n);D.classed("hidden",!1).html(r),Y.classed("hidden",!1)}function n(t){var e=d3.mouse(this)[0],a=d3.mouse(this)[1],n=b.invert(a),r=d3.format(".0%")(n);Y.attr("transform","translate("+e+","+a+")"),D.style("top",d3.event.pageY-45+"px").style("left",d3.event.pageX+5+"px").html(r)}var r="#fentanyl-lines",s=[{date:new Date("01/01/2014"),FentanylHeroin:"0.19",Fentanyl:"0.22",Heroin:"0.41",Methadone:"0.10"},{date:new Date("04/01/2014"),FentanylHeroin:"0.18",Fentanyl:"0.19",Heroin:"0.49",Methadone:"0.07"},{date:new Date("07/01/2014"),FentanylHeroin:"0.14",Fentanyl:"0.14",Heroin:"0.53",Methadone:"0.10"},{date:new Date("10/01/2014"),FentanylHeroin:"0.22",Fentanyl:"0.27",Heroin:"0.35",Methadone:"0.06"},{date:new Date("01/01/2015"),FentanylHeroin:"0.19",Fentanyl:"0.40",Heroin:"0.30",Methadone:"0.04"},{date:new Date("04/01/2015"),FentanylHeroin:"0.24",Fentanyl:"0.38",Heroin:"0.29",Methadone:"0.05"},{date:new Date("07/01/2015"),FentanylHeroin:"0.19",Fentanyl:"0.40",Heroin:"0.30",Methadone:"0.06"},{date:new Date("10/01/2015"),FentanylHeroin:"0.22",Fentanyl:"0.43",Heroin:"0.24",Methadone:"0.05"},{date:new Date("01/01/2016"),FentanylHeroin:"0.15",Fentanyl:"0.50",Heroin:"0.17",Methadone:"0.04"}],o=d3.time.format("%Y"),l=["#ffffff","#b71c1c","#0071bc","#ffffff"],i=["1.5px","3.5px","3.5px","2px"],c=["10,10,10,10","0,0,0,0","0,0,0,0","2,6,0,0"],d=["circle","circle","circle","circle"],u=["1px","1.5px","1.5px","1px"],p=["#a50f15","#08519c","#636363","#636363"],h="date",g={top:30,right:150,bottom:50,left:42},f=540,m=300,v=d3.scale.ordinal().rangePoints([0,f]),y=d3.scale.ordinal().rangePoints([0,f]),b=d3.scale.linear().range([m,0]),x=d3.scale.ordinal().range(l),w=d3.scale.ordinal().range(i),_=d3.scale.ordinal().range(c),$=d3.scale.ordinal().range(d),k=d3.scale.ordinal().range(u),A=d3.scale.ordinal().range(p),N=d3.svg.axis().scale(v).orient("bottom").ticks(d3.time.months,3).tickFormat(t),M=d3.svg.axis().scale(v).ticks(d3.time.years,1).tickFormat(o).tickSize(3,0).tickPadding(1).orient("bottom"),F=d3.format(".0%"),S=d3.svg.axis().scale(b).orient("left").tickFormat(F).ticks(5).tickSize(3,0).tickPadding(1),D=d3.select("body").append("div").attr("class","vis-tooltip"),O=d3.svg.line().x(function(t){return v(t.label)}).y(function(t){return b(t.value)}),j=d3.select(document.querySelector(r)).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+(f+g.left+g.right)+" "+(m+g.top+g.bottom)).classed("svg-content-responsive",!0).append("g").attr("transform","translate("+g.left+","+g.top+")"),C=d3.keys(s[0]).filter(function(t){return t!==h});x.domain(C),w.domain(C),_.domain(C),$.domain(C),k.domain(C),A.domain(C);var P=C.map(function(t){return{name:t,values:s.map(function(e){return{name:t,label:e[h],value:+e[t]}})}});v.domain(s.map(function(t){return t.date})),y.domain(s.map(function(t){return t.date})),b.domain([d3.min(P,function(t){return d3.min(t.values,function(t){return 0})}),d3.max(P,function(t){return d3.max(t.values,function(t){return t.value})})]),j.append("g").attr("class","vis-x-axis").attr("transform","translate(0,"+m+")").call(N).append("path").attr("class","line").style("stroke-width","1.5px").call(N),j.append("g").attr("class","vis-axis").attr("transform","translate(0,"+(m+15)+")").call(M).append("text").attr("x",f-g.left).attr("y",g.bottom-32).attr("dy","1em").attr("class","vis-x-axis-label").text("Quarter"),j.append("g").attr("class","vis-y-axis").call(S).append("text").attr("x",0).attr("y",-44).attr("dy","1em").attr("class","vis-y-axis-label").text("Percent Opioid Deaths");var T=j.selectAll(".series").data(P).enter().append("g").attr("class","seriesData");T.append("path").attr("class","line").attr("d",function(t){return O(t.values)}).style("stroke",function(t){return x(t.name)}).style("stroke-width",function(t){return w(t.name)}).style("stroke-dasharray",function(t){return _(t.name)}).style("fill","none"),T.append("path").attr("class","hit-area-ext").attr("d",function(t){return O(t.values)}).attr("style","stroke:transparent;stroke-width:10px").style("fill","none"),j.append("text").attr("class","vis-data-label").attr("x",f+5).attr("y",b(s[8].FentanylHeroin)-5).attr("dy","1em").text("Fentanyl & Heroin"),j.append("text").attr("class","vis-data-label").attr("x",f+5).attr("y",b(s[8].Methadone)-7).attr("dy","1em").text("Methadone"),j.append("text").attr("class","vis-data-label").attr("x",f+5).attr("y",b(s[8].Heroin)-10).attr("dy","1em").text("Heroin"),j.append("text").attr("class","vis-data-label").attr("x",f+5).attr("y",b(s[8].Fentanyl)-10).attr("dy","1em").text("Fentanyl");var Y=j.append("g").attr("class","focus").classed("hidden",!0);Y.append("circle").style("stroke-width",1).attr("r",6).attr("pointer-events","none"),d3.selectAll("g.seriesData").on("mouseover",a).on("mouseout",e).on("mousemove",n)}();var town_names=["abington","acton","acushnet","adams","agawam","alford","amesbury","amherst","andover","aquinnah","arlington","ashburnham","ashby","ashfield","ashland","athol","attleboro","auburn","avon","ayer","barnstable","barre","becket","bedford","belchertown","bellingham","belmont","berkley","berlin","bernardston","beverly","billerica","blackstone","blandford","bolton","boston","bourne","boxborough","boxford","boylston","braintree","brewster","bridgewater","brimfield","brockton","brookfield","brewster","bridgewater","brimfield","brockton","brookfield","brookline","buckland","burlington","cambridge","canton","carlisle","carver","charlemont","charlton","chatham","chelmsford","chelsea","cheshire","chester","chesterfield","chicopee","chilmark","clarksburg","clinton","cohasset","colrain","concord","conway","cummington","dalton","danvers","dartmouth","dedham","deerfield","dennis","dighton","douglas","dover","dracut","dudley","dunstable","duxbury","eastbridgewater","eastbrookfield","eastlongmeadow","eastham","easthampton","easton","edgartown","egremont","erving","essex","everett","fairhaven","fallriver","falmouth","fitchburg","florida","foxborough","framingham","franklin","freetown","gardner","gay head","georgetown","gill","gloucester","goshen","gosnold","grafton","granby","granville","greatbarrington","greenfield","groton","groveland","hadley","halifax","hamilton","hampden","hancock","hanover","hanson","hardwick","harvard","harwich","hatfield","haverhill","hawley","heath","hingham","hinsdale","holbrook","holden","holland","holliston","holyoke","hopedale","hopkinton","hubbardston","hudson","hull","huntington","ipswich","kingston","lakeville","lancaster","lanesborough","lawrence","lee","leicester","lenox","leominster","leverett","lexington","leyden","lincoln","littleton","longmeadow","lowell","ludlow","lunenburg","lynn","lynnfield","malden","manchester","mansfield","marblehead","marion","marlborough","marshfield","mashpee","mattapoisett","maynard","medfield","medford","medway","melrose","mendon","merrimac","methuen","middleborough","middlefield","middleton","milford","millbury","millis","millville","milton","monroe","monson","montague","monterey","montgomery","mountwashington","nahant","nantucket","natick","needham","newashford","newbedford","newbraintree","newmarlborough","newsalem","newbury","newburyport","newton","norfolk","westadams","westandover","westattleborough","westbrookfield","westreading","northampton","northborough","northbridge","northfield","norton","norwell","norwood","oak bluffs","oakham","orange","orleans","otis","oxford","palmer","paxton","peabody","pelham","pembroke","pepperell","peru","petersham","phillipston","pittsfield","plainfield","plainville","plymouth","plympton","princeton","provincetown","quincy","randolph","raynham","reading","rehoboth","revere","richmond","rochester","rockland","rockport","rowe","rowley","royalston","russell","rutland","salem","salisbury","sandisfield","sandwich","saugus","savoy","scituate","seekonk","sharon","sheffield","shelburne","sherborn","shirley","shrewsbury","shutesbury","somerset","somerville","southhadley","southampton","southborough","southbridge","southwick","spencer","springfield","sterling","stockbridge","stoneham","stoughton","stow","sturbridge","sudbury","sunderland","sutton","swampscott","swansea","taunton","templeton","tewksbury","tisbury","tolland","topsfield","townsend","truro","tyngsborough","tyringham","upton","uxbridge","wakefield","wales","walpole","waltham","ware","wareham","warren","warwick","washington","watertown","wayland","webster","wellesley","wellfleet","wendell","wenham","westboylston","westbridgewater","westbrookfield","westnewbury","westspringfield","weststockbridge","westtisbury","westborough","westfield","westford","westhampton","westminster","weston","westport","westwood","weymouth","whately","whitman","wilbraham","williamsburg","williamstown","wilmington","winchendon","winchester","windsor","winthrop","woburn","worcester","worthington","wrentham","yarmouth"],current_town="massachusetts",margin_bsas={top:0,right:50,bottom:30,left:50},width_bsas=650-margin_bsas.left-margin_bsas.right,height_bsas=400-margin_bsas.top-margin_bsas.bottom,bisectAge=d3.bisector(function(t){return t.age}).left,percent=d3.format(",.1%"),yearformat=d3.format("d"),groups={},x=d3.scale.linear().range([0,width_bsas]),y=d3.scale.linear().range([height_bsas,0]),color=d3.scale.category10(),xAxis_bsas=d3.svg.axis().scale(x).tickFormat(yearformat).orient("bottom").outerTickSize(0),yAxis_bsas=d3.svg.axis().scale(y).tickSize(width_bsas).orient("right").tickFormat(percent),line=d3.svg.line().x(function(t){return x(t.age)}).y(function(t){return y(t.value)}).defined(function(t){return y(t.value)}),$lines_bsas=d3.select("#lines-bsas").append("svg").attr("width",width_bsas+margin_bsas.left+margin_bsas.right).attr("height",height_bsas+margin_bsas.top+margin_bsas.bottom).append("g").attr("transform","translate("+margin_bsas.left+","+margin_bsas.top+")");d3.csv("js/data/bsas-data.csv",type,function(t,e){function a(){for($lines_bsas.select(".line.alcohol").transition().duration(600).delay(180).attr("d",function(t){return line(groups[current_town+"alcohol"].values)}),i=0;i<groups[current_town+"alcohol"].values.length;i++){var t=".circle.alcohol.y"+groups[current_town+"alcohol"].values[i].age;groups[current_town+"alcohol"].values[i].value>=0?$lines_bsas.selectAll(t).transition().duration(600).attr("cx",function(t){return x(groups[current_town+"alcohol"].values[i].age)}).attr("cy",function(t){return y(groups[current_town+"alcohol"].values[i].value)}).attr("r",3):$lines_bsas.selectAll(t).transition().duration(600).attr("r",0)}for($lines_bsas.select(".line.marijuana").transition().duration(600).attr("d",function(t){return line(groups[current_town+"marijuana"].values)}),i=0;i<groups[current_town+"marijuana"].values.length;i++){var t=".circle.marijuana.y"+groups[current_town+"marijuana"].values[i].age;groups[current_town+"marijuana"].values[i].value>=0?$lines_bsas.selectAll(t).transition().duration(600).attr("cx",function(t){return x(groups[current_town+"marijuana"].values[i].age)}).attr("cy",function(t){return y(groups[current_town+"marijuana"].values[i].value)}).attr("r",3):$lines_bsas.selectAll(t).transition().duration(600).attr("r",0)}for($lines_bsas.select(".line.none").transition().duration(600).attr("d",function(t){return line(groups[current_town+"none"].values)}),i=0;i<groups[current_town+"none"].values.length;i++){var t=".circle.none.y"+groups[current_town+"none"].values[i].age,e=groups[current_town+"none"].values[i].value;
groups[current_town+"none"].values[i].value>=0?$lines_bsas.selectAll(t).transition().duration(600).attr("cx",function(t){return x(groups[current_town+"none"].values[i].age)}).attr("cy",function(t){return y(groups[current_town+"none"].values[i].value)}).attr("r",3):$lines_bsas.selectAll(t).transition().duration(600).attr("r",0)}for($lines_bsas.select(".line.opioids").transition().duration(600).attr("d",function(t){return line(groups[current_town+"opioids"].values)}),i=0;i<groups[current_town+"opioids"].values.length;i++){var t=".circle.opioids.y"+groups[current_town+"opioids"].values[i].age,e=groups[current_town+"opioids"].values[i].value;e>=0?$lines_bsas.selectAll(t).transition().duration(600).attr("cx",function(t){return x(groups[current_town+"opioids"].values[i].age)}).attr("cy",function(t){return y(groups[current_town+"opioids"].values[i].value)}).attr("r",3):$lines_bsas.selectAll(t).transition().duration(600).attr("r",0)}for($lines_bsas.select(".line.other").transition().duration(600).attr("d",function(t){return line(groups[current_town+"other"].values)}),i=0;i<groups[current_town+"other"].values.length;i++){var t=".circle.other.y"+groups[current_town+"other"].values[i].age,e=groups[current_town+"other"].values[i].value;e>=0?$lines_bsas.selectAll(t).transition().duration(600).attr("cx",function(t){return x(groups[current_town+"other"].values[i].age)}).attr("cy",function(t){return y(groups[current_town+"other"].values[i].value)}).attr("r",3):$lines_bsas.selectAll(t).transition().duration(600).attr("r",0)}}function n(){var t=x.invert(d3.mouse(this)[0]),e=bisectAge(groups[current_town+"alcohol"].values,t,1),a=groups[current_town+"alcohol"].values[e-1],n=groups[current_town+"alcohol"].values[e],r=t-a.age>n.age-t?n:a;r.value>=0?(l.attr("transform","translate("+x(r.age)+","+y(r.value)+")"),l.select("text").text(percent(r.value)),l.select("circle").attr("r",4)):(l.select("circle").attr("r",0),l.select("text").text(""));var s=bisectAge(groups[current_town+"marijuana"].values,t,1),o=groups[current_town+"marijuana"].values[s-1],i=groups[current_town+"marijuana"].values[s],h=t-o.age>i.age-t?i:o;h.value>=0?(c.attr("transform","translate("+x(h.age)+","+y(h.value)+")"),c.select("text").text(percent(h.value)),c.select("circle").attr("r",4)):(c.select("circle").attr("r",0),c.select("text").text(""));var g=bisectAge(groups[current_town+"none"].values,t,1),f=groups[current_town+"none"].values[g-1],m=groups[current_town+"none"].values[g],v=t-f.age>m.age-t?m:f;v.value>=0?(d.attr("transform","translate("+x(v.age)+","+y(v.value)+")"),d.select("text").text(percent(v.value)),d.select("circle").attr("r",4)):(d.select("circle").attr("r",0),d.select("text").text(""));var b=bisectAge(groups[current_town+"opioids"].values,t,1),w=groups[current_town+"opioids"].values[b-1],_=groups[current_town+"opioids"].values[b],$=t-w.age>_.age-t?_:w;$.value>=0?(u.attr("transform","translate("+x($.age)+","+y($.value)+")"),u.select("text").text(percent($.value)),u.select("circle").attr("r",4)):(u.select("circle").attr("r",0),u.select("text").text(""));var k=bisectAge(groups[current_town+"other"].values,t,1),A=groups[current_town+"other"].values[k-1],N=groups[current_town+"other"].values[k],M=t-A.age>N.age-t?N:A;M.value>=0?(p.attr("transform","translate("+x(M.age)+","+y(M.value)+")"),p.select("text").text(percent(M.value)),p.select("circle").attr("r",4)):(p.select("circle").attr("r",0),p.select("text").text("")),t>80?(l.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),c.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),d.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),u.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning"),p.select("text").attr("x",3).attr("y",-7).attr("text-anchor","beginning")):(l.select("text").attr("x",10).attr("text-anchor","beginning"),c.select("text").attr("x",10).attr("text-anchor","beginning"),d.select("text").attr("x",10).attr("text-anchor","beginning"),u.select("text").attr("x",10).attr("text-anchor","beginning"),p.select("text").attr("x",10).attr("text-anchor","beginning"))}if(t)throw t;x.domain([2005,d3.max(e,function(t){return t.age})]),y.domain([0,.99]),$lines_bsas.append("g").attr("class","vis-x-axis").attr("transform","translate(0,"+height_bsas+")").call(xAxis_bsas).append("text").attr("x",635).attr("y",15).attr("text-anchor","middle").text("Year"),$lines_bsas.append("g").attr("class","vis-y-axis").call(yAxis_bsas).append("text").style("text-anchor","start"),$lines_bsas.selectAll(".vis-y-axis text").attr("x",-43).attr("dy",0);var r=-40,s=-50;for($lines_bsas.append("circle").attr("class","circle opioids").attr("cx",width_bsas+s).attr("cy",25).attr("r",3),$lines_bsas.append("g").append("text").attr("class","focus opioids").attr("x",width_bsas+r).attr("y",28).text("opioids"),$lines_bsas.append("circle").attr("class","circle alcohol").attr("cx",width_bsas+s).attr("cy",40).attr("r",3),$lines_bsas.append("g").append("text").attr("class","focus alcohol").attr("x",width_bsas+r).attr("y",43).text("alcohol"),$lines_bsas.append("circle").attr("class","circle marijuana").attr("cx",width_bsas+s).attr("cy",55).attr("r",3),$lines_bsas.append("g").append("text").attr("class","focus marijuana").attr("x",width_bsas+r).attr("y",58).text("marijuana"),$lines_bsas.append("circle").attr("class","circle other").attr("cx",width_bsas+s).attr("cy",70).attr("r",3),$lines_bsas.append("g").append("text").attr("class","focus other").attr("x",width_bsas+r).attr("y",73).text("other"),$lines_bsas.append("circle").attr("class","circle none").attr("cx",width_bsas+s).attr("cy",82).attr("r",3),$lines_bsas.append("g").append("text").attr("class","focus none").attr("x",width_bsas+r).attr("y",88).text("none"),$lines_bsas.append("path").attr("class","line alcohol").attr("d",function(t){return line(groups[current_town+"alcohol"].values)}),i=0;i<groups[current_town+"alcohol"].values.length;i++){var o=(groups[current_town+"alcohol"].values[i].age,groups[current_town+"alcohol"].values[i].value);o>=0&&$lines_bsas.append("circle").attr("class",function(t){return"circle alcohol y"+groups[current_town+"alcohol"].values[i].age}).attr("cx",x(groups[current_town+"alcohol"].values[i].age)).attr("cy",y(groups[current_town+"alcohol"].values[i].value)).attr("r",3)}for($lines_bsas.append("path").attr("class","line marijuana").attr("d",function(t){return line(groups[current_town+"marijuana"].values)}),i=0;i<groups[current_town+"marijuana"].values.length;i++){var o=(groups[current_town+"marijuana"].values[i].age,groups[current_town+"marijuana"].values[i].value);o>=0&&$lines_bsas.append("circle").attr("class",function(t){return"circle marijuana y"+groups[current_town+"marijuana"].values[i].age}).attr("cx",x(groups[current_town+"marijuana"].values[i].age)).attr("cy",y(groups[current_town+"marijuana"].values[i].value)).attr("r",3)}for($lines_bsas.append("path").attr("class","line none").attr("d",function(t){return line(groups[current_town+"none"].values)}),i=0;i<groups[current_town+"none"].values.length;i++){var o=(groups[current_town+"none"].values[i].age,groups[current_town+"none"].values[i].value);o>=0&&$lines_bsas.append("circle").attr("class",function(t){return"circle none y"+groups[current_town+"none"].values[i].age}).attr("cx",x(groups[current_town+"none"].values[i].age)).attr("cy",y(groups[current_town+"none"].values[i].value)).attr("r",3)}for($lines_bsas.append("path").attr("class","line opioids").attr("d",function(t){return line(groups[current_town+"opioids"].values)}),i=0;i<groups[current_town+"opioids"].values.length;i++){var o=(groups[current_town+"opioids"].values[i].age,groups[current_town+"opioids"].values[i].value);o>=0&&$lines_bsas.append("circle").attr("class",function(t){return"circle opioids y"+groups[current_town+"opioids"].values[i].age}).attr("cx",x(groups[current_town+"opioids"].values[i].age)).attr("cy",y(groups[current_town+"opioids"].values[i].value)).attr("r",3)}for($lines_bsas.append("path").attr("class","line other").attr("d",function(t){return line(groups[current_town+"other"].values)}),i=0;i<groups[current_town+"other"].values.length;i++){var o=(groups[current_town+"other"].values[i].age,groups[current_town+"other"].values[i].value);o>=0&&$lines_bsas.append("circle").attr("class",function(t){return"circle other y"+groups[current_town+"other"].values[i].age}).attr("cx",x(groups[current_town+"other"].values[i].age)).attr("cy",y(groups[current_town+"other"].values[i].value)).attr("r",3)}$(".btn-bsas").addClass("active"),d3.selectAll(".btn-bsas").on("click",function(){current_town=d3.select(this).attr("data-val"),a(),$("#tags").val("")}),$("#tags").autocomplete({source:function(t,e){var a=$.map(town_names,function(e){if(0===e.toUpperCase().indexOf(t.term.toUpperCase()))return e});e(a)},select:function(t,e){current_town=e.item.value,$(".btn-bsas").removeClass("active"),a()}});var l=$lines_bsas.append("g").attr("class","focus alcohol").style("display","none");l.append("circle").attr("r",3),l.append("text").attr("x",9).attr("dy",".35em");var c=$lines_bsas.append("g").attr("class","focus marijuana").style("display","none");c.append("circle").attr("r",3),c.append("text").attr("x",9).attr("dy",".35em");var d=$lines_bsas.append("g").attr("class","focus none").style("display","none");d.append("circle").attr("r",3),d.append("text").attr("x",9).attr("dy",".35em");var u=$lines_bsas.append("g").attr("class","focus opioids").style("display","none");u.append("circle").attr("r",3),u.append("text").attr("x",9).attr("dy",".35em");var p=$lines_bsas.append("g").attr("class","focus other").style("display","none");p.append("circle").attr("r",3),p.append("text").attr("x",9).attr("dy",".35em"),$lines_bsas.append("rect").attr("class","overlay").attr("width",width_bsas).attr("height",height_bsas).on("mouseover",function(){c.style("display",null),l.style("display",null),d.style("display",null),u.style("display",null),p.style("display",null)}).on("mouseout",function(){c.style("display","none"),l.style("display","none"),d.style("display","none"),u.style("display","none"),p.style("display","none")}).on("mousemove",n)}),$(document).ready(function(){function asignVal_substance(t,e){$("#people").empty(),$("#people").each(function(){makeChart_substance(t,e),$("#table_substance").html('<table class="table" id="table_substance"><tr><th>Present</th><th>Not Present</th></tr><tr><td class="type_substance0">'+t[e].Yes+'%</td><td class="type_substance1">'+t[e].No+"%</td></tr></table>")})}function makeChart_substance(t,e){var a=[],n=Math.round(t[e].No),r=Math.round(t[e].Yes);blockArray=addBlocks_substance("#people",r,n,t,a,e),addBlock_substance("#people",a,0)}function addBlocks_substance(t,e,a,n,r,s){for(b=0;b<a;b++)r.push('<div class="block type_substance1 data-index='+n[s].No+'"></div>');for(b=0;b<e;b++)$(t).append('<div class="block type_substance0 data-index='+n[s].Yes+'"></div>');return r}function addBlock_substance(t,e,a){a<blockArray.length&&($(t).append(e[a]),a++,addBlock_substance(t,e,a))}function getParent(){return this.parentNode}function getValue(t){return t.value}function getSum(t){var e=0;return t.forEach(function(t){e+=t.value}),e}function arcTween(t){function e(t){return arc(n(t))}function a(e){return t.endAngle=n(e),arc(t)}var n;return"undefined"==typeof this._current?(n=d3.interpolate(t.startAngle+.1,t.endAngle),this._current=t,a):(n=d3.interpolate(this._current,t),this._current=n(0),e)}function labelAnimation(t){return"translate ("+arc.centroid(t)+")"}function fill(t,e){return color(e)}function selectArcAnimation(t){var e=.05*outerRadius;t.midAngle=(t.endAngle-t.startAngle)/2+t.startAngle;var a=Math.sin(t.midAngle)*e,n=-Math.cos(t.midAngle)*e;return"translate("+a+","+n+")"}function updatePie(data){function getPercent(t){return(t.value/sum*100).toFixed(1)+"%"}function getLegend(t){return t.data.name+" Present | "+t.data.value}function liveLarge(t){var e=360*(t.value/sum),a=Math.PI*(outerRadius/2)*e/180;return a>Math.PI*outerRadius*.01}function onMouseIn(d,i){function onClick(d,i){console.log(d.data.option),$(".substance-type").html(d.data.description),$("#total").html(d.data.value),"buprenorphine"==d.data.option?$("#timeline_blocks").attr("max",0):$("#timeline_blocks").attr("max",3),data_substance=eval(d.data.option),asignVal_substance(data_substance,time)}explodedIndex=i,onClick(d,i);var label=$pie_substance.selectAll(".legend").filter(function(t,e){return i===e});label.attr("data-exit")||label.transition().duration(animateDuration/2).attr({opacity:1,transform:"translate(10, "+(labelHeight+5)*i+")"}),$pie_substance.selectAll(".arc").filter(function(t,e){return i===e}).transition().duration(animateDuration/2).attr("transform",selectArcAnimation),$pie_substance.select(".main-legend").select(".border").transition().duration(animateDuration/2).attr({opacity:1,stroke:fill(null,i)}),$pie_substance.select(".main-legend").select(".circle").transition().duration(animateDuration/2).attr({opacity:1,fill:fill(null,i)}),$pie_substance.select(".main-legend").select("line").transition().duration(animateDuration/2).attr({opacity:1,stroke:fill(null,i),x1:Math.sin(d.midAngle)*(.7*innerRadius),y1:-Math.cos(d.midAngle)*(.7*innerRadius),x2:Math.sin(d.midAngle)*innerRadius,y2:-Math.cos(d.midAngle)*innerRadius}),$pie_substance.select(".main-legend").select(".legend-title").text(d.data.name).select(getParent).select(".description").text(d.data.value)}function onMouseOut(t,e){if($pie_substance.select(".main-legend").selectAll([".circle",".border"]).transition().duration(animateDuration/2).attr({opacity:0}),$pie_substance.select(".main-legend").select("line").transition().duration(animateDuration/2).attr({opacity:0}),$pie_substance.select(".main-legend").select(".legend-title").text("").select(getParent).select(".description").text(""),"undefined"!=typeof e){var a=$pie_substance.selectAll(".legend").filter(function(t,a){return e===a});a.attr("data-exit")||a.transition().duration(animateDuration/2).attr({opacity:1,transform:"translate(0, "+(labelHeight+5)*e+")"}),$pie_substance.selectAll(".arc").filter(function(t,a){return e===a}).transition().duration(animateDuration/2).attr({transform:"translate(0,0)"})}}var sum=getSum(data);data=pie(data);var arcs=$pie_substance.select(".pie").selectAll(".arc").data(data),isDelay=arcs.selectAll("path").length,_duration=isDelay?animateDuration:animateDuration/2;onMouseOut(),arcs.enter().append("g").attr("class","arc").on("click",function(t,e){explodedIndex>=0&&onMouseOut(null,explodedIndex),onMouseIn(t,e)}).append("path").attr({fill:fill}).attr("d",arc).style("stroke","white").style("stroke-width",2).select(getParent).filter(liveLarge).append("text").attr({"font-family":"Arial","font-size":"14px",fill:"#fff","text-anchor":"middle"}),arcs.select("path").transition().delay(function(t,e){return isDelay?0:_duration*e}).duration(_duration).attrTween("d",arcTween),arcs.select("text").text(getPercent).transition().duration(animateDuration).attr({class:"label-content",transform:labelAnimation}),arcs.exit().on("mouseenter",null).on("mouseout",null).remove();var legends=$pie_substance.select(".labels").selectAll(".legend").data(data);legends.enter().append("g").on("click",function(t,e){explodedIndex>=0&&onMouseOut(null,explodedIndex),onMouseIn(t,e)}).attr("class","legend").append("rect").attr({width:labelWidth,height:labelHeight,fill:fill}).select(getParent).append("text").attr({"font-size":"14px","font-family":"Arial",fill:"#666",x:labelWidth+5,y:labelHeight/2+5}).select(getParent).attr({opacity:0,transform:function(t,e){return"translate(15, "+(labelHeight+5)*e+")"}}).transition().duration(animateDuration).attr({opacity:1,transform:function(t,e){return"translate(0, "+(labelHeight+5)*e+")"}}),legends.exit().on("mouseenter",null).on("mouseout",null).attr("data-exit",!0).transition().duration(animateDuration/2).attr({opacity:0,transform:function(t,e){return"translate(-15, "+(labelHeight+5)*e+")"}}).remove(),legends.select("text").html(getLegend)}function generatePie(t){updatePie(t)}var prescription=[{Yes:83,No:17},{Yes:57,No:43},{Yes:50,No:50},{Yes:37,No:63}],heroin=[{Yes:65,No:35},{Yes:28,No:72},{Yes:20,No:80},{Yes:13,No:87}],fentanyl=[{Yes:68,No:32},{Yes:30,No:70},{Yes:22,No:78},{Yes:17,No:83}],both=[{Yes:64,No:36},{Yes:24,No:76},{Yes:15,No:85},{Yes:9,No:91}],methadone=[{Yes:76,No:24},{Yes:46,No:54},{Yes:41,No:59},{Yes:27,No:73}],buprenorphine=[{Yes:60,No:40},{Yes:60,No:40},{Yes:60,No:40},{Yes:60,No:40}],data_substance=prescription,time=0;asignVal_substance(data_substance,time),$("#studyperiod").addClass("active"),$(".btn-time").on("click",function(){$(".btn-time").removeClass("active"),$(this).addClass("active"),time=parseInt($(this).val()),asignVal_substance(data_substance,time);var t;switch(time){case 0:t="During the Study Period";break;case 1:t="6 Months Before Death";break;case 2:t="3 Months Before Death";break;case 3:t="1 Month Before Death"}$("#time-perioid").html(t.toLowerCase()),$("#label_blocks").html(t)});var margin={top:10,bottom:10,left:10,right:0},width=550-margin.left-margin.right,height=300-margin.top-margin.bottom,labelsWidth=.4*width,labelWidth=.1*labelsWidth,labelHeight=.6*labelWidth,animateDuration=300,outerRadius=width-labelsWidth<height?(width-labelsWidth)/2:height/2,innerRadius=.5*outerRadius,arc=d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius),pie=d3.layout.pie().sort(null).value(getValue).startAngle(1.1*Math.PI).endAngle(3.1*Math.PI),explodedIndex,color=d3.scale.ordinal().range(["#b71c1c","#d32f2f","#f44336","#ef5350","#e57373","#ef9a9a"]),$pie_substance=d3.select("#piechart").attr({width:width+margin.left+margin.right,height:height+margin.top+margin.bottom}).append("g").attr({class:"labels",transform:"translate("+(width-(labelsWidth+margin.right))+", "+margin.top+")"}).select(getParent).append("g").attr({class:"pie",transform:"translate("+(outerRadius+margin.left)+", "+(height/2+margin.top)+")"}).select(getParent).append("g").attr({class:"main-legend",transform:"translate("+(outerRadius+margin.left)+", "+(outerRadius+margin.top)+")"}).select(getParent);$pie_substance.select(".main-legend").append("circle").attr({class:"border",opacity:0,stroke:"rgba(255,255,255,1)",fill:"rgba(0,0,0,0)",r:.9*innerRadius}).select(getParent).append("circle").attr({class:"circle",opacity:0,fill:"rgba(255,255,255,1)",r:.9*innerRadius}).select(getParent).append("line").attr({opacity:0,stroke:"rgba(255,255,255,1)",x1:0,y1:0,x2:0,y2:0}).select(getParent).append("text").attr({class:"legend-title","font-size":"18px",y:-1*innerRadius*.13,"font-family":"Arial","text-anchor":"middle","alignment-baseline":"middle",fill:"#fff"}).select(getParent).append("text").attr({class:"description","font-size":"14px",y:.13*innerRadius,"font-family":"Arial","text-anchor":"middle","alignment-baseline":"middle",fill:"#fff"});var data_pie=[{name:"Heroin",value:867,option:"heroin",description:"heroin"},{name:"Fentanyl",value:288,option:"fentanyl",description:"fentanyl"},{name:"Fentanyl & Heroin",value:249,option:"both",description:"both fentanyl and heroin"},{name:"Prescription Opioid",value:154,option:"prescription",description:"prescription opioid"},{name:"Methadone",value:84,option:"methadone",description:"methadone"},{name:"Buprenorphine",value:15,option:"buprenorphine",description:"buprenorphine"}];generatePie(data_pie)}),$(document).ready(function(){function asignVal_gender(option,value){$("#buttons-blocks button").removeClass("active"),$("#"+option).addClass("active"),$("#gender").empty(),makeChart_gender(eval(option)),$("#table_gender").html(table_html[value])}function makeChart_gender(t){var e=[];for(i=0;i<6;i++){var a=Math.round(t[i][1]);blockArray_gender=addBlocks_gender("#gender",a,t,e)}addBlock_gender("#gender",blockArray_gender,0)}function addBlock_gender(t,e,a){a<e.length&&($(t).append(e[a]),a++,addBlock_gender(t,e,a))}function addBlocks_gender(t,e,a,n){for(b=0;b<e;b++)n.push('<div class="block type_gender'+i+" data-index="+a[i][0]+'"></div>');return n}var prescription=[[0,0],["No",58],["Yes",13],["Yes",8],["No",21],[0,0]],heroin=[[0,0],["No",22],["Yes",49],["Yes",17],["No",12],[0,0]],multi=[["1",15],["2",31],["3",25],["3",18],["2",9],["1",2]],table_html=['<table class="table" id="table_gender"><tr><th></th><th>Present</th><th>Not Present</th></tr><tr><th>Male</th><td class="type_gender2">'+prescription[2][1]+'%</td><td class="type_gender1">'+prescription[1][1]+'%</td></tr><tr><th>Female</th><td class="type_gender3">'+prescription[3][1]+'%</td><td class="type_gender4">'+prescription[4][1]+"%</td></tr></table>",'<table class="table" id="table_gender"><tr><th></th><th>Present</th><th>Not Present</th></tr><tr><th>Male</th><td class="type_gender2">'+heroin[2][1]+'%</td><td class="type_gender1">'+heroin[1][1]+'%</td></tr><tr><th>Female</th><td class="type_gender3">'+heroin[3][1]+'%</td><td class="type_gender4">'+heroin[4][1]+"%</td></tr></table>",'<table class="table" id="table_gender"><tr><th></th><th>0 Prescribers</th><th>12 Prescribers</th><th>3+ Prescribers</th></tr><tr><th>Male</th><td td class="type_gender0">'+multi[0][1]+'%</td><td td class="type_gender1">'+multi[1][1]+'%</td><td td class="type_gender2">'+multi[2][1]+'%</td></tr><tr><th>Female</th><td td class="type_gender5">'+multi[5][1]+'%</td><td td class="type_gender4">'+multi[4][1]+'%</td><td td class="type_gender3">'+multi[3][1]+"%</td></tr></table>"],data_gender=prescription;makeChart_gender(prescription),$("#table_gender").html(table_html[0]),$("#prescription").addClass("active"),$(".controls-block").click(function(){var $option=$(this).data("select"),$value=eval($(this).val());asignVal_gender($option,$value)}),$(".btn-blocks").click(function(){var $option=$(this).attr("id"),$value=eval($(this).val());asignVal_gender($option,$value)})}),function(){function t(t,e){return t.sort(function(t,a){return a[e]-t[e]})}function e(t,e){var o=d3.max(t,function(t){return+t[e]});xScale=d3.scale.linear().domain([0,o]).range([0,a]),yScale=d3.scale.ordinal().domain(d3.range(t.length)).rangeBands([0,n],.2);var l=s.selectAll("rect.bar").data(t,function(t){return t.gender_age}),i=d3.scale.ordinal().range(["#64B5F6","#FF80AB"]),c=d3.scale.ordinal().range(["Male","Female"]),d=s.selectAll(".vis-legend").data(["2014","2015"]).enter().append("g").attr("class","vis-legend").attr("transform",function(t,e){return"translate(0,"+(n-2*r+24*e)+")"});d.append("rect").attr("x",a-18).attr("width",20).attr("height",20).style("fill",i),d.append("text").attr("x",a+10).attr("y",9).attr("dy",".5em").style("text-anchor","start").text(c),l.enter().append("rect").attr("class","bar"),l.exit().transition().duration(200).ease("exp").attr("width",0).remove(),l.transition().duration(500).ease("quad").attr("width",function(t){return xScale(+t[e])}).attr("height",yScale.rangeBand()).attr("transform",function(t,e){return"translate("+[0+r,yScale(e)]+")"}).attr("class",function(t,e){return"Male"===t.gender&&"18 to 24"===t.age?"bar malFocus age18to24":"Female"===t.gender&&"18 to 24"===t.age?"bar femFocus age18to24":"Female"===t.gender&&"25 to 34"===t.age?"bar femFocus age25to34":"Male"===t.gender&&"25 to 34"===t.age?"bar malFocus age25to34":"Female"===t.gender?"bar femFocus":"Male"===t.gender?"bar malFocus":void 0});var u=s.selectAll("text.vis-data-label").data(t,function(t){return t.gender_age}),p=s.selectAll("text.vis-axis").data(t,function(t){return t.gender_age});p.enter().append("text").attr("class","vis-axis"),p.exit().remove(),u.enter().append("text").attr("class","vis-data-label"),u.exit().remove(),numberFormat=d3.format(".0f"),percentageFormat=d3.format(".1f"),rateFormat=d3.format(".2f"),u.transition().duration(500).attr("transform",function(t,a){return console.log(xScale(+t[e])+50),console.log(t[e]),"translate("+(xScale(+t[e])+r)+","+(yScale(a)+4)+")"}).text(function(t){return"percentOpiodDeaths"==e&&"65+"==t.age?"<1%":"percentOpiodDeaths"==e&&"65+"!=t.age?percentageFormat(t[e])+"%":"numberOpioidDeaths"==e?numberFormat(t[e]):rateFormat(t[e])}).attr("dy","1em").attr("dx","5px"),p.transition().duration(500).attr("transform",function(t,e){return"translate(0,"+(yScale(e)+5)+")"}).text(function(t){return t.age}).attr("dy","1em").attr("dx","40px")}var a=600,n=300,r=50,s=d3.select("#changing_bars").append("svg").attr("width",a+100).attr("height",n+10);s.append("rect").attr("width","100%").attr("height","100%").attr("fill","none"),d3.csv("js/data/bars-age.csv",function(a,n){var r="percentOpiodDeaths",s=t(n,r);e(s,r),d3.select("#POD").classed("selected",!0),$("#POD").addClass("active"),d3.select("#POD").on("click",function(a,o){r="percentOpiodDeaths",s=t(n,r),e(s,r);var l=d3.select(this);d3.selectAll("#buttons-bar button").classed("selected",!1),$("#buttons-bar button").removeClass("active"),d3.selectAll("#age18to24").classed("selected",!1),$("#age18to24").removeClass("active"),l.classed("selected",!0),$(this).addClass("active")}),d3.select("#DR").on("click",function(a,o){r="deathRate",s=t(n,r),e(s,r);var l=d3.select(this);d3.selectAll("#buttons-bar button").classed("selected",!1),$("#buttons-bar button").removeClass("active"),d3.selectAll("#age18to24").classed("selected",!1),$("#age18to24").removeClass("active"),l.classed("selected",!0),$(this).addClass("active")}),d3.select("#NOD").on("click",function(a,o){r="numberOpioidDeaths",s=t(n,r),e(s,r);var l=d3.select(this);d3.selectAll("#buttons-bar button").classed("selected",!1),$("#buttons-bar button").removeClass("active"),d3.selectAll("#age18to24").classed("selected",!1),$("#age18to24").removeClass("active"),l.classed("selected",!0),$(this).addClass("active")}),d3.select("#age18to24").on("click",function(t,e){var a=d3.select(this);a.classed("selected",!0),$(this).addClass("active"),d3.selectAll(".malFocus.age18to24").classed("malSelector",!0),d3.selectAll(".femFocus.age18to24").classed("femSelector",!0),d3.selectAll(".malFocus.age25to34").classed("malSelector",!1),d3.selectAll(".femFocus.age25to34").classed("femSelector",!1)}),d3.select("#age25to34").on("click",function(t,e){var a=d3.select(this);a.classed("selected",!0),$(this).addClass("active"),d3.selectAll(".malFocus.age25to34").classed("malSelector",!0),d3.selectAll(".femFocus.age25to34").classed("femSelector",!0),d3.selectAll(".malFocus.age18to24").classed("malSelector",!1),d3.selectAll(".femFocus.age18to24").classed("femSelector",!1)})})}(),$(document).ready(function(){function t(t,e){t.each(function(){for(var t,a=d3.select(this),n=a.text().split(/\s+/).reverse(),r=[],s=0,o=1.1,l=a.attr("y"),i=parseFloat(a.attr("dy")),c=a.text(null).append("tspan").attr("x",0).attr("y",l).attr("dy",i+"em");t=n.pop();)r.push(t),c.text(r.join(" ")),c.node().getComputedTextLength()>e&&(r.pop(),c.text(r.join(" ")),r=[t],c=a.append("tspan").attr("x",0).attr("y",l).attr("dy",++s*o+i+"em").text(t))})}dataset=[{raceth:"All",2014:19.8,2015:23.2},{raceth:"White non-Hispanic",2014:23.3,2015:27.1},{raceth:"Black non-Hispanic",2014:11.1,2015:13.6},{raceth:"Hispanic",2014:15.3,2015:19.5}];var e=d3.scale.ordinal().range(["#2166ac","#92c5de"]),a={top:parseInt(d3.select("#race_ethnicity_chart").style("width"),10)/10,right:parseInt(d3.select("#race_ethnicity_chart").style("width"),10)/20,bottom:parseInt(d3.select("#race_ethnicity_chart").style("width"),10)/5,left:parseInt(d3.select("#race_ethnicity_chart").style("width"),10)/10},n=parseInt(d3.select("#race_ethnicity_chart").style("width"),10)-a.left-a.right,r=500-a.top-a.bottom,s=d3.scale.ordinal().rangeRoundBands([0,n],.1),o=d3.scale.ordinal(),i=d3.scale.linear().range([r,0]),c=d3.svg.axis().scale(s).orient("bottom"),d=d3.svg.axis().scale(i).orient("left").tickFormat(d3.format(".0f")),u=d3.select("#race_ethnicity_chart").append("div").classed("vis-tooltip hidden",!0),p=d3.select("#race_ethnicity_chart").append("svg").attr("width",n+a.left+a.right).attr("height",r+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),h=d3.keys(dataset[0]).filter(function(t){return"raceth"!==t});dataset.forEach(function(t){t.values=h.map(function(e){return{name:e,value:+t[e]}})}),s.domain(dataset.map(function(t){return t.raceth})),o.domain(h).rangeRoundBands([0,s.rangeBand()]),i.domain([0,d3.max(dataset,function(t){return d3.max(t.values,function(t){return t.value})})]),p.append("g").attr("class","vis-x-axis").attr("transform","translate(10,"+r+")").call(c).selectAll(".tick text").call(t,s.rangeBand()),p.append("g").attr("class","vis-y-axis").call(d).append("text").attr("y",-35).attr("dy",".71em").attr("class","vis-y-axis-label").text("Age Adjusted Rates per 100,000");var g=p.selectAll(".bar").data(dataset).enter().append("g").attr("class","rect").attr("transform",function(t){return"translate("+(s(t.raceth)-10)+",0)"});g.selectAll("rect").data(function(t){return t.values}).enter().append("rect").attr("width",o.rangeBand()).attr("x",function(t){return o(t.name)+5}).attr("y",function(t){return i(t.value)}).attr("value",function(t){return t.name}).attr("height",function(t){return r-i(t.value)}).style("fill",function(t){return e(t.name)}),g.on("mousemove",function(t){u.style("left",d3.event.pageX-$("#race_ethnicity_chart").offset().left+"px"),u.style("top",d3.event.pageY-$("#race_ethnicity_chart").offset().top+"px"),u.classed("hidden",!1);var e=(d3.event.pageX,d3.event.pageY,document.querySelectorAll(":hover"));l=e.length,l-=1,elementData=e[l].__data__,u.html("<rate>"+elementData.value+"</rate>")}),g.on("mouseout",function(t){u.classed("hidden",!0)});var f=p.selectAll(".vis-legend").data(h.slice()).enter().append("g").attr("class","vis-legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});f.append("rect").attr("x",n-18).attr("width",18).attr("height",18).style("fill",e),f.append("text").attr("x",n-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t})});
//# sourceMappingURL=main.js.map
